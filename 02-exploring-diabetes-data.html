<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Rafaela Ribeiro Lucas, Federica Gazzelloni, and Lucy Michaels">
<meta name="dcterms.date" content="2025-12-17">
<meta name="description" content="This tutorial demonstrates exploratory data analysis (EDA) techniques on a simulated diabetes dataset for the years 2015 and 2025, covering data import, pre-processing, visualization, summary statistics, prevalence calculation, and statistical inference.">
<title>From Basics to Advanced Health Analytics: Exploring Diabetes Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./01-getting-started.html" rel="prev">
<link href="./images/logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e4d17f6bf434d0fd56e6096692e49019.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<link href="site_libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="site_libs/tabwid-1.1.3/tabwid.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="From Basics to Advanced Health Analytics: Exploring Diabetes Data">
<meta property="og:description" content="This tutorial demonstrates exploratory data analysis (EDA) techniques on a simulated diabetes dataset for the years 2015 and 2025, covering data import, pre-processing, visualization, summary statistics, prevalence calculation, and statistical inference.">
<meta property="og:image" content="https://rladiesrome.github.io/Principles-of-data-Analysis-in-R/02-exploring-diabetes-data_files/figure-html/fig-hba1c-2015-1.png">
<meta property="og:image:alt" content="Histogram and density plot showing the distribution of HbA1c levels for 2015">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
<meta name="twitter:title" content="From Basics to Advanced Health Analytics: Exploring Diabetes Data">
<meta name="twitter:description" content="This tutorial demonstrates exploratory data analysis (EDA) techniques on a simulated diabetes dataset for the years 2015 and 2025, covering data import, pre-processing, visualization, summary statistics, prevalence calculation, and statistical inference.">
<meta name="twitter:image" content="https://rladiesrome.github.io/Principles-of-data-Analysis-in-R/02-exploring-diabetes-data_files/figure-html/fig-hba1c-2015-1.png">
<meta name="twitter:creator" content="@rladiesrome">
<meta name="twitter:image:alt" content="Histogram and density plot showing the distribution of HbA1c levels for 2015">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="1344">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Principles of Data Analysis in R</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About Us</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://rladiesrome.org/"> <i class="bi bi-globe" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rladiesrome"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02-exploring-diabetes-data.html">3. Data Analytics</a></li><li class="breadcrumb-item"><a href="./02-exploring-diabetes-data.html">3.1 Exploring Diabetes Data</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav><div id="quarto-announcement" data-announcement-id="d7a43450c80459af5bfbd602820c1da9" class="alert alert-info hidden">
<i class="bi bi-info-circle quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p><strong>Alert</strong> - Course 1: Wednesday, 17 December 2025 at 18:00 CEST.</p>
</div>
<i class="bi bi-x-lg quarto-announcement-action"></i>
</div>
</header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./images/homepage-logo.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none"><img src="./images/homepage-logo.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none"></a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">3. Data Analytics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-exploring-diabetes-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">3.1 Exploring Diabetes Data</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
<li><a href="#research-in-context" id="toc-research-in-context" class="nav-link" data-scroll-target="#research-in-context">Research in Context</a></li>
  <li><a href="#research-questions" id="toc-research-questions" class="nav-link" data-scroll-target="#research-questions">Research Questions</a></li>
  </ul>
</li>
  <li>
<a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">Packages</a>
  <ul class="collapse">
<li><a href="#install-required-packages" id="toc-install-required-packages" class="nav-link" data-scroll-target="#install-required-packages">Install Required Packages</a></li>
  <li><a href="#load-required-libraries" id="toc-load-required-libraries" class="nav-link" data-scroll-target="#load-required-libraries">Load Required Libraries</a></li>
  </ul>
</li>
  <li><a href="#data-import" id="toc-data-import" class="nav-link" data-scroll-target="#data-import">Data Import</a></li>
  <li>
<a href="#pre-processing" id="toc-pre-processing" class="nav-link" data-scroll-target="#pre-processing">Pre-processing</a>
  <ul class="collapse">
<li><a href="#data-manipulation" id="toc-data-manipulation" class="nav-link" data-scroll-target="#data-manipulation">Data Manipulation</a></li>
  <li><a href="#data-inspection" id="toc-data-inspection" class="nav-link" data-scroll-target="#data-inspection">Data Inspection</a></li>
  <li><a href="#handling-missing-values" id="toc-handling-missing-values" class="nav-link" data-scroll-target="#handling-missing-values">Handling Missing Values</a></li>
  <li><a href="#creating-derived-variables" id="toc-creating-derived-variables" class="nav-link" data-scroll-target="#creating-derived-variables">Creating Derived Variables</a></li>
  </ul>
</li>
  <li>
<a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</a>
  <ul class="collapse">
<li><a href="#distribution-plot-for-hba1c-2015-only" id="toc-distribution-plot-for-hba1c-2015-only" class="nav-link" data-scroll-target="#distribution-plot-for-hba1c-2015-only">Distribution plot for HbA1c (2015 only)</a></li>
  <li><a href="#hba1c-distribution-in-both-years" id="toc-hba1c-distribution-in-both-years" class="nav-link" data-scroll-target="#hba1c-distribution-in-both-years">HbA1c distribution in both years</a></li>
  <li><a href="#age-distribution-by-year" id="toc-age-distribution-by-year" class="nav-link" data-scroll-target="#age-distribution-by-year">Age distribution by year</a></li>
  <li><a href="#age-boxplots" id="toc-age-boxplots" class="nav-link" data-scroll-target="#age-boxplots">Age Boxplots</a></li>
  </ul>
</li>
  <li>
<a href="#summary-statistics" id="toc-summary-statistics" class="nav-link" data-scroll-target="#summary-statistics">Summary Statistics</a>
  <ul class="collapse">
<li><a href="#comparisons-by-year" id="toc-comparisons-by-year" class="nav-link" data-scroll-target="#comparisons-by-year">Comparisons by Year</a></li>
  </ul>
</li>
  <li>
<a href="#prevalence-calculation" id="toc-prevalence-calculation" class="nav-link" data-scroll-target="#prevalence-calculation">Prevalence Calculation</a>
  <ul class="collapse">
<li><a href="#prevalence-table-with-confidence-intervals" id="toc-prevalence-table-with-confidence-intervals" class="nav-link" data-scroll-target="#prevalence-table-with-confidence-intervals">Prevalence Table with Confidence Intervals</a></li>
  <li><a href="#visualize-diabetes-prevalence-by-year" id="toc-visualize-diabetes-prevalence-by-year" class="nav-link" data-scroll-target="#visualize-diabetes-prevalence-by-year">Visualize diabetes prevalence by year</a></li>
  <li><a href="#interaction" id="toc-interaction" class="nav-link" data-scroll-target="#interaction">Interaction</a></li>
  </ul>
</li>
  <li>
<a href="#qualitative-statistical-inference" id="toc-qualitative-statistical-inference" class="nav-link" data-scroll-target="#qualitative-statistical-inference">Qualitative Statistical Inference</a>
  <ul class="collapse">
<li><a href="#chi-square-test-for-year-and-diabetes-status" id="toc-chi-square-test-for-year-and-diabetes-status" class="nav-link" data-scroll-target="#chi-square-test-for-year-and-diabetes-status">Chi-square Test for Year and Diabetes Status</a></li>
  <li><a href="#chi-square-test-for-country-and-diabetes-status-in-2025" id="toc-chi-square-test-for-country-and-diabetes-status-in-2025" class="nav-link" data-scroll-target="#chi-square-test-for-country-and-diabetes-status-in-2025">Chi-square Test for Country and Diabetes Status in 2025</a></li>
  </ul>
</li>
  <li>
<a href="#k-prototypes-clustering" id="toc-k-prototypes-clustering" class="nav-link" data-scroll-target="#k-prototypes-clustering">K-prototypes Clustering</a>
  <ul class="collapse">
<li><a href="#data-preparation-for-clustering" id="toc-data-preparation-for-clustering" class="nav-link" data-scroll-target="#data-preparation-for-clustering">Data Preparation for Clustering</a></li>
  <li><a href="#checking-redundancy-and-association-between-variables" id="toc-checking-redundancy-and-association-between-variables" class="nav-link" data-scroll-target="#checking-redundancy-and-association-between-variables">Checking Redundancy and Association Between Variables</a></li>
  <li><a href="#data-quality-checks-outliers-and-rare-categories" id="toc-data-quality-checks-outliers-and-rare-categories" class="nav-link" data-scroll-target="#data-quality-checks-outliers-and-rare-categories">Data Quality Checks: Outliers and Rare Categories</a></li>
  <li><a href="#choosing-the-number-of-clusters" id="toc-choosing-the-number-of-clusters" class="nav-link" data-scroll-target="#choosing-the-number-of-clusters">Choosing the Number of Clusters</a></li>
  <li><a href="#run-k-prototypes-clustering" id="toc-run-k-prototypes-clustering" class="nav-link" data-scroll-target="#run-k-prototypes-clustering">Run K-prototypes Clustering</a></li>
  <li><a href="#external-validation-using-diabetes-status" id="toc-external-validation-using-diabetes-status" class="nav-link" data-scroll-target="#external-validation-using-diabetes-status">External Validation Using Diabetes Status</a></li>
  <li><a href="#cluster-quality-silhouette-analysis" id="toc-cluster-quality-silhouette-analysis" class="nav-link" data-scroll-target="#cluster-quality-silhouette-analysis">Cluster Quality: Silhouette Analysis</a></li>
  <li><a href="#boxplots-cluster-compositions" id="toc-boxplots-cluster-compositions" class="nav-link" data-scroll-target="#boxplots-cluster-compositions">Boxplots &amp; Cluster Compositions</a></li>
  <li><a href="#key-clinical-insights" id="toc-key-clinical-insights" class="nav-link" data-scroll-target="#key-clinical-insights">Key Clinical Insights:</a></li>
  </ul>
</li>
  <li>
<a href="#bonus" id="toc-bonus" class="nav-link" data-scroll-target="#bonus">Bonus</a>
  <ul class="collapse">
<li><a href="#frequency-table-for-bmi-categories" id="toc-frequency-table-for-bmi-categories" class="nav-link" data-scroll-target="#frequency-table-for-bmi-categories">Frequency Table for BMI Categories</a></li>
  <li><a href="#bmi-categories-by-year" id="toc-bmi-categories-by-year" class="nav-link" data-scroll-target="#bmi-categories-by-year">BMI Categories by Year</a></li>
  <li><a href="#visualizing-bmi-categories-by-year" id="toc-visualizing-bmi-categories-by-year" class="nav-link" data-scroll-target="#visualizing-bmi-categories-by-year">Visualizing BMI Categories by Year</a></li>
  <li><a href="#proportional-distribution-of-bmi-categories-by-year" id="toc-proportional-distribution-of-bmi-categories-by-year" class="nav-link" data-scroll-target="#proportional-distribution-of-bmi-categories-by-year">Proportional Distribution of BMI Categories by Year</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/rladiesrome/Principles-of-data-Analysis-in-R/edit/main/02-exploring-diabetes-data.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/rladiesrome/Principles-of-data-Analysis-in-R/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02-exploring-diabetes-data.html">3. Data Analytics</a></li><li class="breadcrumb-item"><a href="./02-exploring-diabetes-data.html">3.1 Exploring Diabetes Data</a></li></ol></nav><div class="quarto-title">
<h1 class="title">From Basics to Advanced Health Analytics: Exploring Diabetes Data</h1>
<p class="subtitle lead">An Exploratory Data Analysis (EDA) Tutorial</p>
  <div class="quarto-categories">
    <div class="quarto-category">Tutorials</div>
    <div class="quarto-category">EDA</div>
    <div class="quarto-category">Diabetes</div>
    <div class="quarto-category">Clustering</div>
  </div>
  </div>

<div>
  <div class="description">
    <p>This tutorial demonstrates exploratory data analysis (EDA) techniques on a simulated diabetes dataset for the years 2015 and 2025, covering data import, pre-processing, visualization, summary statistics, prevalence calculation, and statistical inference.</p>
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Rafaela Ribeiro Lucas, Federica Gazzelloni, and Lucy Michaels </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 17, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="overview" class="level2"><h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>In this session, we perform an exploratory data analysis on a simulated diabetes dataset for 2015 and 2025. The dataset used in this tutorial is <strong>simulated</strong>, this means that the 2015 and 2025 data are <strong>not real patient records</strong> and are <strong>not drawn from GBD estimates or surveillance systems</strong>. Instead, they consist of synthetic data designed to resemble realistic diabetes patterns over time, including changes in prevalence, laboratory measurements, and population structure.</p>
<p>The use of simulated data allows the analysis to focus on <strong>methodology</strong>, <strong>workflow</strong>, and <strong>interpretation</strong>, without privacy constraints or data access limitations. All results should therefore be interpreted as illustrative examples of analytical techniques rather than as epidemiological estimates.</p>
<p>To explore how diabetes prevalence and characteristics vary over time and across populations, in this tutorial we will cover:</p>
<ul>
<li>Data Import</li>
<li>Pre-processing</li>
<li>Exploratory Data Visualization (EDA)</li>
<li>Summary Statistics</li>
<li>Prevalence Calculation</li>
<li>Qualitative Statistical Inference</li>
</ul>
<blockquote class="blockquote">
<p>Why Diabetes?</p>
</blockquote>
<p><strong>Diabetes</strong> is a chronic health condition that affects how the body turns food into energy (blood glucose). It includes <strong>Type 1</strong>, <strong>Type 2</strong>, and <strong>gestational diabetes</strong>. The dataset used in this analysis contains information on individuals’ <code>diabetes status</code>, <code>laboratory measurements</code> (such as HbA1c levels), <code>demographic information</code> (age, sex, country), and <code>other health-related variables</code>.</p>
<p>At the population level, diabetes is a major contributor to illness (<code>morbidity</code>) and premature death (<code>mortality</code>). Classified as a <strong>non-communicable disease (NCD)</strong>, it is associated with various complications, including <code>cardiovascular disease</code>, <code>kidney failure</code>, and <code>neuropathy.</code></p>
<section id="research-in-context" class="level3"><h3 class="anchored" data-anchor-id="research-in-context">Research in Context</h3>
<p>The <strong>Global Burden of Disease (GBD)</strong> study often identifies diabetes as a key driver of global health loss. According to <strong>GBD 2023</strong> estimates, approximately <strong>561 million people</strong> were living with diabetes worldwide in <strong>2023</strong>, which is roughly <span class="math inline">\(7\%\)</span> of the world’s population (561 million out of <span class="math inline">\(~8\)</span> billion).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> In the same year, diabetes accounted for about <strong>90.2 million disability-adjusted life years (DALYs)</strong> globally, representing approximately <span class="math inline">\(3.2\%\)</span> of total global DALYs. Diabetes also contributed substantially to non-fatal health loss, with an estimated <strong>44.2 million years lived with disability (YLDs)</strong> in 2023, representing about <span class="math inline">\(4.5\%\)</span> of all global YLDs.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>From an analytical perspective, diabetes is commonly studied using measures such as <code>prevalence rates,</code> <code>risk factors</code>, and <code>associations with other health conditions</code>. Typical statistical tools include <code>descriptive statistics</code>, <code>hypothesis testing</code> (e.g., chi-square tests for categorical variables) for group comparisons, and exploratory methods such as <code>clustering</code>, <code>regression analysis</code>, and, in some settings, <code>survival analysis</code>.</p>
</section><section id="research-questions" class="level3"><h3 class="anchored" data-anchor-id="research-questions">Research Questions</h3>
<p>To focus the analysis, we begin by defining the research questions addressed in this tutorial:</p>
<blockquote class="blockquote">
<ol type="1">
<li>Has the prevalence of diabetes changed significantly between 2015 and 2025?</li>
</ol>
</blockquote>
<blockquote class="blockquote">
<ol start="2" type="1">
<li>Does the prevalence of diabetes differ significantly between countries in the year 2025?</li>
</ol>
</blockquote>
</section></section><section id="packages" class="level2"><h2 class="anchored" data-anchor-id="packages">Packages</h2>
<p>Before we start, we load a small set of packages.</p>
<section id="install-required-packages" class="level3"><h3 class="anchored" data-anchor-id="install-required-packages">Install Required Packages</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"readxl"</span>, <span class="st">"janitor"</span>, <span class="st">"tidyverse"</span>, </span>
<span>                   <span class="st">"scales"</span>, <span class="st">"crosstable"</span>, </span>
<span>                   <span class="st">"vcd"</span>, <span class="st">"DescTools"</span>, </span>
<span>                   <span class="st">"cluster"</span>, <span class="st">"clustMixType"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="load-required-libraries" class="level3"><h3 class="anchored" data-anchor-id="load-required-libraries">Load Required Libraries</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Packages for Data Manipulation and Visualization</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span> <span class="co"># For read_excel()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span> <span class="co"># For clean_names()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> <span class="co"># For data manipulation and visualization</span></span>
<span><span class="co"># tidyverse::tidyverse_packages()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span> <span class="co"># For scale_y_continuous(labels = scales::percent)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://danchaltiel.github.io/crosstable/">crosstable</a></span><span class="op">)</span> <span class="co"># For crosstable()</span></span>
<span><span class="co"># Packages for Clustering</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">vcd</span><span class="op">)</span>    <span class="co"># For assocstats()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://andrisignorell.github.io/DescTools/">DescTools</a></span><span class="op">)</span> <span class="co"># For CramerV()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/cluster/">cluster</a></span><span class="op">)</span> <span class="co"># For data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">clustMixType</span><span class="op">)</span> <span class="co"># For k-prototypes clustering</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="data-import" class="level2"><h2 class="anchored" data-anchor-id="data-import">Data Import</h2>
<p>Data are stored in one Excel file with two sheets: one for 2015 and one for 2025. We read each sheet into R and clean the column names so they are consistent and easy to type.</p>
<p>We use the <code>read_excel</code> function from the <code>readxl</code> package to read the data and the <code>clean_names</code> function from the <code>janitor</code> package to clean the column names.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"data/diabetes_study_filled_NEW.xlsx"</span></span>
<span></span>
<span><span class="va">d2015</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">path</span>, </span>
<span>                            sheet <span class="op">=</span> <span class="st">"2015"</span><span class="op">)</span> </span>
<span><span class="va">d2025</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">path</span>, </span>
<span>                            sheet <span class="op">=</span> <span class="st">"2025"</span><span class="op">)</span> </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="pre-processing" class="level2"><h2 class="anchored" data-anchor-id="pre-processing">Pre-processing</h2>
<p>The pre-processing phase is crucial for ensuring the quality and integrity of the data before conducting any analysis. Data are often messy and may contain <strong>inconsistencies</strong>, <strong>missing values</strong>, or <strong>irrelevant information</strong> that can affect the results of the analysis.</p>
<section id="data-manipulation" class="level3"><h3 class="anchored" data-anchor-id="data-manipulation">Data Manipulation</h3>
<p>Combine data for comparative analyses by year is straightforward, we <em>stack</em> the two datasets into a single table and add a year column. This is <strong>data manipulation</strong>; we merge the two datasets from 2015 and 2025 into a single dataset, adding a new column to indicate the year of each observation.</p>
<p>In particular, we use the <code>bind_rows</code> function from the <code>dplyr</code> package to stack the two datasets vertically, and the <code>mutate</code> function to create a new column called <code>year</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">d2015</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2015</span><span class="op">)</span>,</span>
<span>  <span class="va">d2025</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2025</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-note callout-titled" title="Pipe Operators">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Pipe Operators
</div>
</div>
<div class="callout-body-container callout-body">
<p>This material uses both the native R pipe (<strong>|&gt;</strong>) and the tidyverse pipe (<strong>%&gt;%</strong>). They are functionally equivalent and interchangeable in this context.</p>
</div>
</div>
</section><section id="data-inspection" class="level3"><h3 class="anchored" data-anchor-id="data-inspection">Data Inspection</h3>
<p>The first step is to check the initial structure of the data and identify any missing values. We can use the <code>head</code> function to view the first few rows of the dataset.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Checking initial structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data_raw</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
   year country   age sex   bmi_cat       sdi     lab_hba1c diabetes_self_report
  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;               
1  2015 Brazil     42 woman Obesity       Interm…       4.9 no                  
2  2015 Brazil     64 woman Normal weight Interm…       6.1 no                  
3  2015 Brazil     82 woman Obesity       Interm…       4.8 no                  
4  2015 Brazil     55 woman Normal weight Interm…       6   no                  
5  2015 Brazil     59 woman Underweight   Interm…       5.6 no                  
6  2015 Brazil     42 men   Normal weight Interm…       6.3 no                  
# ℹ 1 more variable: gestational_diabetes &lt;chr&gt;</code></pre>
</div>
</div>
<p>Then, we perform data inspection with the <code>str</code> or <code>glimpse</code> functions to understand the data types and structure of each variable. Both functions provide a concise summary of the dataset, including the number of observations, variables, and their respective data types.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">data_raw</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 500
Columns: 9
$ year                 &lt;dbl&gt; 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2…
$ country              &lt;chr&gt; "Brazil", "Brazil", "Brazil", "Brazil", "Brazil",…
$ age                  &lt;dbl&gt; 42, 64, 82, 55, 59, 42, 54, 51, 73, 66, 54, 65, 4…
$ sex                  &lt;chr&gt; "woman", "woman", "woman", "woman", "woman", "men…
$ bmi_cat              &lt;chr&gt; "Obesity", "Normal weight", "Obesity", "Normal we…
$ sdi                  &lt;chr&gt; "Intermediate", "Intermediate", "Intermediate", "…
$ lab_hba1c            &lt;dbl&gt; 4.9, 6.1, 4.8, 6.0, 5.6, 6.3, 5.2, 5.8, 6.2, 6.0,…
$ diabetes_self_report &lt;chr&gt; "no", "no", "no", "no", "no", "no", "no", "no", "…
$ gestational_diabetes &lt;chr&gt; "no", "no", "no", "no", "no", "no", "no", "no", "…</code></pre>
</div>
</div>
</section><section id="handling-missing-values" class="level3"><h3 class="anchored" data-anchor-id="handling-missing-values">Handling Missing Values</h3>
<p>Next, we check for missing values (NA) with <code>is.na</code> function. This function returns a logical matrix indicating the presence of missing values in the dataset. To count the number of missing values in each column, we can use the <code>colSums</code> function in combination with <code>is.na</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Checking missing values (NA)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data_raw</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                year              country                  age 
                   0                    0                    0 
                 sex              bmi_cat                  sdi 
                   0                    0                    0 
           lab_hba1c diabetes_self_report gestational_diabetes 
                   0                    0                    0 </code></pre>
</div>
</div>
<p>There aren’t missing values in the dataset, but if there were, we could handle them using various strategies such as <code>imputation</code>, <code>removal</code>, or <code>flagging</code>, depending on the nature and extent of the missing data.</p>
<div class="callout callout-style-simple callout-note callout-titled" title="Question">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>How would you handle missing values in a dataset? What strategies would you consider?</p>
</div>
</div>
</section><section id="creating-derived-variables" class="level3"><h3 class="anchored" data-anchor-id="creating-derived-variables">Creating Derived Variables</h3>
<p>Data are usually not in the exact format needed for analysis. Therefore, we create new variables based on existing ones to facilitate the analysis. We are looking at making comparisons between two years to see how diabetes level changes along the time.</p>
<p>In this case , we create three derived variables:</p>
<ul>
<li>Laboratory-defined diabetes (<span class="math inline">\(HbA1c ≥ 6.5\)</span>)</li>
<li>Total diabetes (self-report OR laboratory, excluding gestational diabetes)</li>
<li>Age groups (set of age bands to support grouped summaries)</li>
</ul>
<p>This step involves using the <code>mutate</code> function from the <code>dplyr</code> package to create new columns based on conditions applied to existing columns. And we use the <code>if_else</code> and <code>case_when</code> functions to define the logic for these new variables.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_diabetes</span> <span class="op">&lt;-</span> <span class="va">data_raw</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Laboratory-defined diabetes</span></span>
<span>    diabetes_lab <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">lab_hba1c</span> <span class="op">&gt;=</span> <span class="fl">6.5</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>, </span>
<span>                           missing <span class="op">=</span> <span class="cn">NA_character_</span><span class="op">)</span>,</span>
<span>    <span class="co"># Total diabetes (self-report OR laboratory, excluding gestational diabetes)</span></span>
<span>    diabetes_total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">gestational_diabetes</span> <span class="op">==</span> <span class="st">"yes"</span> <span class="op">~</span> <span class="st">"no"</span>,</span>
<span>      <span class="va">diabetes_self_report</span> <span class="op">==</span> <span class="st">"yes"</span> <span class="op">|</span> <span class="va">diabetes_lab</span> <span class="op">==</span> <span class="st">"yes"</span> <span class="op">~</span> <span class="st">"yes"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"no"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># Age groups</span></span>
<span>    age_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">age</span> <span class="op">&lt;</span> <span class="fl">50</span> <span class="op">~</span> <span class="st">"40–49"</span>,</span>
<span>      <span class="va">age</span> <span class="op">&lt;</span> <span class="fl">60</span> <span class="op">~</span> <span class="st">"50–59"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"60+"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="exploratory-data-analysis-eda" class="level2"><h2 class="anchored" data-anchor-id="exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</h2>
<p>Exploratory Data Analysis (EDA) is a crucial step in understanding the underlying patterns, relationships, and distributions within a dataset. It involves using various statistical and graphical techniques to summarize and visualize the data. EDA helps to identify potential issues, outliers, and trends that may inform subsequent analyses or modelling efforts.</p>
<section id="distribution-plot-for-hba1c-2015-only" class="level3"><h3 class="anchored" data-anchor-id="distribution-plot-for-hba1c-2015-only">Distribution plot for HbA1c (2015 only)</h3>
<p>Let’s visualize the distribution of HbA1c levels for the year 2015 using a histogram combined with a density plot. This will help us understand the spread and central tendency of HbA1c values in that year.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d2015</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lab_hba1c</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                 bins <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                 fill <span class="op">=</span> <span class="st">"lightblue"</span>, </span>
<span>                 color <span class="op">=</span> <span class="st">"grey70"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkblue"</span>, </span>
<span>               linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"HbA1c Distribution (2015)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"HbA1c (%)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span> </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-hba1c-2015" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Histogram and density plot showing the distribution of HbA1c levels for 2015">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-hba1c-2015-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-hba1c-2015-1.png" class="img-fluid figure-img" alt="Histogram and density plot showing the distribution of HbA1c levels for 2015" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hba1c-2015-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: HbA1c Distribution (2015)
</figcaption></figure>
</div>
</div>
</div>
</section><section id="hba1c-distribution-in-both-years" class="level3"><h3 class="anchored" data-anchor-id="hba1c-distribution-in-both-years">HbA1c distribution in both years</h3>
<p>To compare the distribution of <strong>HbA1c levels between 2015 and 2025</strong>, we can create a density plot that overlays the distributions for both years. This will allow us to visually assess any changes in HbA1c levels over time.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_diabetes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lab_hba1c</span>, </span>
<span>           fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"HbA1c Distribution — 2015 vs 2025"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"HbA1c (%)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-hba1c-distribution" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Density plot comparing HbA1c levels for 2015 and 2025">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-hba1c-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-hba1c-distribution-1.png" class="img-fluid figure-img" alt="Density plot comparing HbA1c levels for 2015 and 2025" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hba1c-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: HbA1c Distribution — 2015 vs 2025
</figcaption></figure>
</div>
</div>
</div>
</section><section id="age-distribution-by-year" class="level3"><h3 class="anchored" data-anchor-id="age-distribution-by-year">Age distribution by year</h3>
<p>To check the age distribution for both years, we can create overlapping histograms. This will help us visualize how the age distribution of the population has changed from 2015 to 2025.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_diabetes</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, </span>
<span>                     fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"identity"</span>, </span>
<span>                 alpha <span class="op">=</span> <span class="fl">0.5</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Age Distribution: 2015 vs 2025"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Age"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-age-distribution" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Overlapping histograms showing age distribution for 2015 and 2025">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-age-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-age-distribution-1.png" class="img-fluid figure-img" alt="Overlapping histograms showing age distribution for 2015 and 2025" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-age-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Age Distribution: 2015 vs 2025
</figcaption></figure>
</div>
</div>
</div>
</section><section id="age-boxplots" class="level3"><h3 class="anchored" data-anchor-id="age-boxplots">Age Boxplots</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_diabetes</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">age</span>, </span>
<span>           fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Age Distribution by Year"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Age"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span> </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-age-boxplots" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Boxplots showing age distribution for 2015 and 2025, faceted by sex">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-age-boxplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-age-boxplots-1.png" class="img-fluid figure-img" alt="Boxplots showing age distribution for 2015 and 2025, faceted by sex" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-age-boxplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Age Distribution by Year
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="summary-statistics" class="level2"><h2 class="anchored" data-anchor-id="summary-statistics">Summary Statistics</h2>
<p>Now that we have explored the data visually, we can compute some summary statistics to quantify key characteristics of the dataset, and compare them across the two years.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_diabetes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    age_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    age_sd   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">age</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    hba1c_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lab_hba1c</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    hba1c_sd   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">lab_hba1c</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>             [,1]
n          500.00
age_mean    56.34
age_sd      11.86
hba1c_mean   5.96
hba1c_sd     0.92</code></pre>
</div>
</div>
<p>The results show the overall mean and standard deviation for age and HbA1c levels across the entire dataset, without stratifying by year.</p>
<p>The mean age is approximately 56 years, with a standard deviation of about 12 years, indicating a middle-aged population with some variability in age. The mean HbA1c level is around <span class="math inline">\(6.2\%\)</span>, with a standard deviation of about <span class="math inline">\(1.5\%\)</span>, suggesting that, on average, the population has HbA1c levels slightly above the normal range (typically <span class="math inline">\(&lt;5.7\%\)</span> for non-diabetic individuals), with considerable variability.</p>
<section id="comparisons-by-year" class="level3"><h3 class="anchored" data-anchor-id="comparisons-by-year">Comparisons by Year</h3>
<p>To compare these statistics by year, we can use the <code>group_by</code> function to group the data by the <code>year</code> variable before summarising.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_diabetes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    age_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    hba1c_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lab_hba1c</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
   year     n age_mean hba1c_mean
  &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1  2015   250     56.7       5.87
2  2025   250     56.0       6.05</code></pre>
</div>
</div>
</section></section><section id="prevalence-calculation" class="level2"><h2 class="anchored" data-anchor-id="prevalence-calculation">Prevalence Calculation</h2>
<p>To calculate the prevalence of diabetes for each year, we can use the <code>group_by</code> and <code>summarise</code> functions to compute the mean of the binary indicator for diabetes status.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prev_diabetes</span> <span class="op">&lt;-</span> <span class="va">df_diabetes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">diabetes_total</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prev_diabetes</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
# Groups:   year [2]
   year diabetes_total     n  prop
  &lt;dbl&gt; &lt;chr&gt;          &lt;int&gt; &lt;dbl&gt;
1  2015 no               212 0.848
2  2015 yes               38 0.152
3  2025 no               188 0.752
4  2025 yes               62 0.248</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prev_summary</span> <span class="op">&lt;-</span> <span class="va">df_diabetes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>prev_diabetes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">diabetes_total</span> <span class="op">==</span> <span class="st">"yes"</span>, </span>
<span>                                 na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prev_summary</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
   year prev_diabetes
  &lt;dbl&gt;         &lt;dbl&gt;
1  2015         0.152
2  2025         0.248</code></pre>
</div>
</div>
<section id="prevalence-table-with-confidence-intervals" class="level3"><h3 class="anchored" data-anchor-id="prevalence-table-with-confidence-intervals">Prevalence Table with Confidence Intervals</h3>
<p>To calculate prevalence with confidence intervals, we can use the <code>prop.test</code> function within a custom summarise operation.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prev_ci</span> <span class="op">&lt;-</span> <span class="va">df_diabetes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">diabetes_total</span> <span class="op">==</span> <span class="st">"yes"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    prev <span class="op">=</span> <span class="va">cases</span> <span class="op">/</span> <span class="va">n</span>,</span>
<span>    ci_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span><span class="va">cases</span>, <span class="va">n</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    ci_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span><span class="va">cases</span>, <span class="va">n</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">prev_ci</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
   year     n cases  prev ci_lower ci_upper
  &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1  2015   250    38 0.152    0.111    0.204
2  2025   250    62 0.248    0.197    0.307</code></pre>
</div>
</div>
</section><section id="visualize-diabetes-prevalence-by-year" class="level3"><h3 class="anchored" data-anchor-id="visualize-diabetes-prevalence-by-year">Visualize diabetes prevalence by year</h3>
<p>To visualize diabetes prevalence by year, we can create a bar plot using the <code>ggplot2</code> package. This plot will show the proportion of individuals with diabetes for each year.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">prev_ci</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, </span>
<span>           y <span class="op">=</span> <span class="va">prev</span>, </span>
<span>           fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci_lower</span>, </span>
<span>                    ymax <span class="op">=</span> <span class="va">ci_upper</span><span class="op">)</span>, </span>
<span>                width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Diabetes Prevalence by Year"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Prevalence (%)"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-diabetes-prevalence" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Bar plot showing diabetes prevalence for 2015 and 2025 with confidence intervals">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diabetes-prevalence-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-diabetes-prevalence-1.png" class="img-fluid figure-img" alt="Bar plot showing diabetes prevalence for 2015 and 2025 with confidence intervals" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diabetes-prevalence-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Diabetes Prevalence by Year
</figcaption></figure>
</div>
</div>
</div>
</section><section id="interaction" class="level3"><h3 class="anchored" data-anchor-id="interaction">Interaction</h3>
<p>To explore the interaction between gender, age, and diabetes status, we can create a faceted bar plot. This plot will show the distribution of diabetes status across different age groups, separated by gender.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_diabetes</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_group</span>, </span>
<span>           fill <span class="op">=</span> <span class="va">diabetes_total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Diabetes Status by Age Group and Gender"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Age Group"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Proportion"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Diabetes Status"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-diabetes" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Faceted bar plot showing diabetes status by age group and gender">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diabetes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-diabetes-1.png" class="img-fluid figure-img" alt="Faceted bar plot showing diabetes status by age group and gender" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diabetes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Diabetes Status by Age Group and Gender
</figcaption></figure>
</div>
</div>
</div>
<p>Interaction between gender, age and diabetes</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_diabetes</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diabetes_total</span>, y <span class="op">=</span> <span class="va">age</span>, </span>
<span>           fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>, </span>
<span>               outlier.color <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Age Distribution by Diabetes Status and Gender"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Diabetes"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Age"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Gender"</span><span class="op">)</span> </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-age-diabetes-boxplots" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Boxplots showing age distribution by diabetes status and gender">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-age-diabetes-boxplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-age-diabetes-boxplots-1.png" class="img-fluid figure-img" alt="Boxplots showing age distribution by diabetes status and gender" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-age-diabetes-boxplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Age Distribution by Diabetes Status and Gender
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="qualitative-statistical-inference" class="level2"><h2 class="anchored" data-anchor-id="qualitative-statistical-inference">Qualitative Statistical Inference</h2>
<p>To answer our research questions regarding diabetes prevalence, we will use the <strong>Chi-Square Test of Independence</strong>. This test is appropriate for categorical data and helps us determine whether there is a significant association between two categorical variables.</p>
<blockquote class="blockquote">
<p>Question 1: The prevalence of diabetes changed significantly between 2015 and 2025?</p>
</blockquote>
<section id="chi-square-test-for-year-and-diabetes-status" class="level3"><h3 class="anchored" data-anchor-id="chi-square-test-for-year-and-diabetes-status">Chi-square Test for Year and Diabetes Status</h3>
<p>The Chi-square test evaluates whether there is a significant association between the year (2015 vs 2025) and diabetes status (yes vs no).</p>
<p><strong>The chi-squared test statistic is defined as:</strong></p>
<p><span id="eq-chi_squared"><span class="math display">\[
\chi^2 \;=\; \sum_{i=1}^{r} \sum_{j=1}^{c}
\frac{\left(O_{ij} - E_{ij}\right)^2}{E_{ij}}
\tag{1}\]</span></span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(O_{ij}\)</span> is the observed frequency in cell <span class="math inline">\((i,j)\)</span> of the contingency table</li>
<li>
<span class="math inline">\(E_{ij}\)</span> is the expected frequency in the same cell, computed as <span class="math inline">\(E_{ij} = \frac{(\text{row total}_i)(\text{column total}_j)}{\text{grand total}}\)</span>
</li>
<li>
<span class="math inline">\(r\)</span> is the number of rows</li>
<li>
<span class="math inline">\(c\)</span> is the number of columns</li>
</ul>
<p><strong>The hypotheses for this test are:</strong></p>
<p><span class="math display">\[
H_0: \text{Year and diabetes status are independent}
\]</span> <span class="math display">\[
H_A: \text{Year and diabetes status are associated}
\]</span></p>
<p>The null hypothesis (<span class="math inline">\(H_0\)</span>) states that there is no association between the year and diabetes status, meaning that the prevalence of diabetes is the same in both years. The alternative hypothesis (<span class="math inline">\(H_A\)</span>) states that there is an association, indicating that the prevalence of diabetes differs between 2015 and 2025.</p>
<p>The significance level (<span class="math inline">\(\alpha\)</span>) is set at 0.05.</p>
<p><strong>Contingency table for year and diabetes:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">table_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">df_diabetes</span><span class="op">$</span><span class="va">year</span>, </span>
<span>                    <span class="va">df_diabetes</span><span class="op">$</span><span class="va">diabetes_total</span><span class="op">)</span></span>
<span></span>
<span><span class="va">table_year</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      
        no yes
  2015 212  38
  2025 188  62</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chi_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sfirke.github.io/janitor/reference/chisq.test.html">chisq.test</a></span><span class="op">(</span><span class="va">table_year</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chi_year</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test with Yates' continuity correction

data:  table_year
X-squared = 6.6125, df = 1, p-value = 0.01013</code></pre>
</div>
</div>
<p>The p-value is below 0.05, so we reject the null hypothesis and conclude that prevalence differs between 2015 and 2025 in this dataset.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chi_year</span><span class="op">$</span><span class="va">expected</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      
        no yes
  2015 200  50
  2025 200  50</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Standardized Residuals</span></span>
<span><span class="va">res_year</span> <span class="op">&lt;-</span> <span class="va">chi_year</span><span class="op">$</span><span class="va">stdres</span></span>
<span><span class="va">res_year</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      
              no       yes
  2015  2.683282 -2.683282
  2025 -2.683282  2.683282</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Question 2: Will the prevalence of diabetes differ significantly between countries in the year 2025?</p>
</blockquote>
</section><section id="chi-square-test-for-country-and-diabetes-status-in-2025" class="level3"><h3 class="anchored" data-anchor-id="chi-square-test-for-country-and-diabetes-status-in-2025">Chi-square Test for Country and Diabetes Status in 2025</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_diabetes_2025</span> <span class="op">&lt;-</span> <span class="va">df_diabetes</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2025</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Contingency table for countries and diabetes:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tab_2025</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">df_diabetes_2025</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                  <span class="va">df_diabetes_2025</span><span class="op">$</span><span class="va">diabetes_total</span><span class="op">)</span></span>
<span><span class="va">tab_2025</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              
               no yes
  Brazil       42  25
  China        39  11
  Italy        40  10
  South Africa 27   6
  USA          40  10</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chi_2025</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sfirke.github.io/janitor/reference/chisq.test.html">chisq.test</a></span><span class="op">(</span><span class="va">tab_2025</span><span class="op">)</span></span>
<span><span class="va">chi_2025</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  tab_2025
X-squared = 7.8461, df = 4, p-value = 0.09738</code></pre>
</div>
</div>
<p>The p-value is greater than 0.05. Therefore, we fail to reject the null hypothesis and conclude that there is no statistically significant difference in diabetes prevalence between countries in 2025.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chi_2025</span><span class="op">$</span><span class="va">expected</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              
                   no    yes
  Brazil       50.384 16.616
  China        37.600 12.400
  Italy        37.600 12.400
  South Africa 24.816  8.184
  USA          37.600 12.400</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Standardized Residuals</span></span>
<span><span class="va">residuals</span> <span class="op">&lt;-</span> <span class="va">chi_2025</span><span class="op">$</span><span class="va">stdres</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">residuals</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              
                  no   yes
  Brazil       -2.77  2.77
  China         0.51 -0.51
  Italy         0.88 -0.88
  South Africa  0.94 -0.94
  USA           0.88 -0.88</code></pre>
</div>
</div>
<p>Identify where the greatest contribution lies:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/mosaicplot.html">mosaicplot</a></span><span class="op">(</span><span class="va">tab_2025</span>,</span>
<span>           main <span class="op">=</span> <span class="st">"Mosaic Plot — Diabetes by Country (2025)"</span>,</span>
<span>           color <span class="op">=</span> <span class="cn">TRUE</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-mosaic-2025" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Mosaic plot showing the distribution of diabetes status across different countries in 2025">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mosaic-2025-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-mosaic-2025-1.png" class="img-fluid figure-img" alt="Mosaic plot showing the distribution of diabetes status across different countries in 2025" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mosaic-2025-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Mosaic Plot — Diabetes by Country (2025)
</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled" title="Interpretation">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Interpretation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Interpretation: We fail to reject the null hypothesis. There is no statistically significant evidence that diabetes prevalence differs between countries in 2025 at the 5% significance level.</p>
<p>Although some countries show larger deviations from expected counts, these differences are not strong enough, overall, to conclude that prevalence differs significantly across countries.</p>
</div>
</div>
</section></section><section id="k-prototypes-clustering" class="level2"><h2 class="anchored" data-anchor-id="k-prototypes-clustering">K-prototypes Clustering</h2>
<p>In this final analytical step, we explore whether individuals in the 2025 dataset can be grouped into distinct profiles based on a combination of clinical and demographic characteristics. Rather than focusing on hypothesis testing, this section introduces unsupervised learning as an exploratory tool to uncover structure in the data.</p>
<p>Clustering is particularly useful in public health settings when the goal is to:</p>
<ul>
<li>identify subgroups with similar risk profiles,</li>
<li>explore heterogeneity within a population,</li>
<li>generate hypotheses for targeted interventions.</li>
</ul>
<p>Because our dataset contains both numeric and categorical variables, we use the <code>k-prototypes algorithm</code>, which is specifically designed for mixed-type data.</p>
<blockquote class="blockquote">
<p>Why k-prototypes?</p>
</blockquote>
<p>Traditional clustering methods such as <code>k-means</code> only work with numeric variables, while <code>k-modes</code> are limited to categorical data. The <code>k-prototypes</code> algorithm combines both approaches:</p>
<ul>
<li>Euclidean distance is used for numeric variables,</li>
<li>matching dissimilarity is used for categorical variables,</li>
<li>a tuning parameter (<span class="math inline">\(\lambda\)</span>) balances the contribution of each type.</li>
</ul>
<p>This makes k-prototypes well suited for health datasets that mix laboratory values (e.g.&nbsp;<code>HbA1c</code>) with demographic or clinical categories (e.g.&nbsp;<code>sex</code>, <code>BMI group</code>, <code>age band</code>).</p>
<section id="data-preparation-for-clustering" class="level3"><h3 class="anchored" data-anchor-id="data-preparation-for-clustering">Data Preparation for Clustering</h3>
<p>We restrict the clustering analysis to observations from 2025, as the aim is to characterise the most recent population snapshot rather than temporal change.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">df_diabetes_2025</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [250 × 12] (S3: tbl_df/tbl/data.frame)
 $ year                : num [1:250] 2025 2025 2025 2025 2025 ...
 $ country             : chr [1:250] "Brazil" "Brazil" "Brazil" "Brazil" ...
 $ age                 : num [1:250] 44 83 45 48 48 47 55 66 57 66 ...
 $ sex                 : chr [1:250] "woman" "men" "woman" "men" ...
 $ bmi_cat             : chr [1:250] "Normal weight" "Overweight" "Obesity" "Normal weight" ...
 $ sdi                 : chr [1:250] "Intermediate" "Intermediate" "Intermediate" "Intermediate" ...
 $ lab_hba1c           : num [1:250] 6 6.1 5.8 5.9 5.3 6.3 8.8 5.4 5.3 6.4 ...
 $ diabetes_self_report: chr [1:250] "no" "no" "no" "yes" ...
 $ gestational_diabetes: chr [1:250] "no" "no" "no" "no" ...
 $ diabetes_lab        : chr [1:250] "no" "no" "no" "no" ...
 $ diabetes_total      : chr [1:250] "no" "no" "no" "yes" ...
 $ age_group           : chr [1:250] "40–49" "60+" "40–49" "40–49" ...</code></pre>
</div>
</div>
<p>Before clustering, variables must be correctly typed. Numeric variables should remain numeric, while categorical variables must be encoded as factors. Watch out for numerics which are really categories.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cluster_data_2025</span> <span class="op">&lt;-</span> <span class="va">df_diabetes_2025</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">year</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">cluster_data_2025</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [250 × 11] (S3: tbl_df/tbl/data.frame)
 $ country             : Factor w/ 5 levels "Brazil","China",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ age                 : num [1:250] 44 83 45 48 48 47 55 66 57 66 ...
 $ sex                 : Factor w/ 2 levels "men","woman": 2 1 2 1 1 2 2 1 1 2 ...
 $ bmi_cat             : Factor w/ 4 levels "Normal weight",..: 1 3 2 1 2 2 2 3 2 2 ...
 $ sdi                 : Factor w/ 3 levels "High","Intermediate",..: 2 2 2 2 2 2 2 2 2 2 ...
 $ lab_hba1c           : num [1:250] 6 6.1 5.8 5.9 5.3 6.3 8.8 5.4 5.3 6.4 ...
 $ diabetes_self_report: Factor w/ 2 levels "no","yes": 1 1 1 2 1 2 1 1 1 2 ...
 $ gestational_diabetes: Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 1 ...
 $ diabetes_lab        : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 2 1 1 1 ...
 $ diabetes_total      : Factor w/ 2 levels "no","yes": 1 1 1 2 1 2 2 1 1 2 ...
 $ age_group           : Factor w/ 3 levels "40–49","50–59",..: 1 3 1 1 1 1 2 3 2 3 ...</code></pre>
</div>
</div>
<p>At this stage, the dataset contains a mixture of numeric and categorical features suitable for k-prototypes clustering.</p>
</section><section id="checking-redundancy-and-association-between-variables" class="level3"><h3 class="anchored" data-anchor-id="checking-redundancy-and-association-between-variables">Checking Redundancy and Association Between Variables</h3>
<p>Clustering can be distorted if highly redundant variables are included. We therefore assess association within numeric variables and dependence among categorical variables.</p>
<section id="numeric-correlation-pearson" class="level4"><h4 class="anchored" data-anchor-id="numeric-correlation-pearson">Numeric Correlation (Pearson)</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cluster_data_2025</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">select_if</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  age   lab_hba1c
age       1.000000000 0.008397291
lab_hba1c 0.008397291 1.000000000</code></pre>
</div>
</div>
<p><code>Age</code> and <code>HbA1c</code> show little correlation, so both can be retained. However, <code>age_group</code> is derived directly from age, so age is removed later to avoid duplicating the same information. So we will drop <code>age</code> from the clustering dataset.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">features_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="co">#"age", </span></span>
<span>                  <span class="st">"lab_hba1c"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="categorical-association-cramérs-v" class="level4"><h4 class="anchored" data-anchor-id="categorical-association-cramérs-v">Categorical Association (Cramér’s V)</h4>
<p>For categorical variables, we use <code>Cramér’s V</code>, a normalized measure derived from the <code>chi-square</code> statistic:</p>
<p><span id="eq-cramers_v"><span class="math display">\[
V = \sqrt{\frac{\chi^2 / n}{\min(k - 1, r - 1)}}
\tag{2}\]</span></span></p>
<p>Where:<br>
- <span class="math inline">\(\chi^2\)</span> is the Chi-square statistic<br>
- <span class="math inline">\(n\)</span> is the total number of observations<br>
- <span class="math inline">\(k\)</span> is the number of categories in one variable<br>
- <span class="math inline">\(r\)</span> is the number of categories in the other variable</p>
<p>Cramér’s V is a measure of association between two nominal categorical variables. It ranges from 0 (no association) to 1 (perfect association). It is based on the Chi-square statistic and is useful for understanding the strength of association between categorical variables.</p>
<p>The inventor of Cramér’s V, Harald Cramér, did not specify strict cut-offs for interpreting the values. However, in practice, researchers often use the following guidelines to interpret the strength of association:</p>
<ul>
<li>0 to 0.1: Negligible association</li>
<li>0.1 to 0.3: Weak association</li>
<li>0.3 to 0.5: Moderate association</li>
<li>0.5 to 1.0: Strong association</li>
</ul>
<p>In this case, we will identify pairs of categorical variables with <strong>Cramér’s V less than or equal to 0.5</strong>, indicating weak to moderate associations.</p>
<p>We first examine the relationship between <code>country</code> and <code>sdi</code>, which are conceptually related using the <code><a href="https://rdrr.io/pkg/vcd/man/assocstats.html">assocstats()</a></code> function from the <code>vcd</code> package:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">vcd</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/assocstats.html">assocstats</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">country</span>, <span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">sdi</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">cramer</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8998341</code></pre>
</div>
</div>
<p>Or, we can even use the <code><a href="https://andrisignorell.github.io/DescTools/reference/CramerV.html">CramerV()</a></code> function from the <code>DescTools</code> package:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">DescTools</span><span class="fu">::</span><span class="fu"><a href="https://andrisignorell.github.io/DescTools/reference/CramerV.html">CramerV</a></span><span class="op">(</span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">country</span>, <span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">sdi</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8998341</code></pre>
</div>
</div>
<p>Both packages show a value of 0.9, indicating a high association between <code>country</code> and <code>SDI.</code> The high association suggests that including both variables may overweight the same socioeconomic information. However, association with other categorical variables is weaker, so this decision is not automatic and requires judgement.</p>
<p><strong>Test all pairs of categorical features</strong></p>
<p>To examine this systematically, we compute Cramér’s V for all pairs of categorical variables setting up a function to compute Cramér’s V for any two categorical variables:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cramers_v</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://andrisignorell.github.io/DescTools/reference/CramerV.html">CramerV</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Extract the names of all categorical features:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cluster_data_2025</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "country"              "sex"                  "bmi_cat"             
[4] "sdi"                  "diabetes_self_report" "gestational_diabetes"
[7] "diabetes_lab"         "diabetes_total"       "age_group"           </code></pre>
</div>
</div>
<p>We focus on a subset of categorical features for clarity:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">features_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sex"</span>, </span>
<span>                  <span class="st">"bmi_cat"</span>, </span>
<span>                  <span class="co">#"country", </span></span>
<span>                  <span class="co">#"sdi",</span></span>
<span>                  <span class="st">"age_group"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then we use the <code>expand_grid</code> function to create all possible pairs of categorical features, compute Cramér’s V for each pair, and filter for weak to moderate associations (Cramér’s V <span class="math inline">\(&lt;= 0.5\)</span>):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span><span class="op">(</span>feature1 <span class="op">=</span> <span class="va">features_cat</span>,</span>
<span>            feature2 <span class="op">=</span> <span class="va">features_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">feature1</span> <span class="op">&lt;</span> <span class="va">feature2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># keep unique pairs only</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cramers_v <span class="op">=</span> <span class="fu">cramers_v</span><span class="op">(</span></span>
<span>    <span class="va">cluster_data_2025</span><span class="op">[[</span><span class="va">feature1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    <span class="va">cluster_data_2025</span><span class="op">[[</span><span class="va">feature2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Filter for Cramér's V &lt;= 0.5 to identify weak to moderate associations</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cramers_v</span> <span class="op">&lt;=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">cramers_v</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">cramers_df</span></span>
<span></span>
<span><span class="va">cramers_df</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
# Rowwise: 
  feature1  feature2 cramers_v
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
1 bmi_cat   sex         0.124 
2 age_group sex         0.0698
3 age_group bmi_cat     0.0578</code></pre>
</div>
</div>
<p>This confirms that the retained categorical variables are not strongly redundant.</p>
</section></section><section id="data-quality-checks-outliers-and-rare-categories" class="level3"><h3 class="anchored" data-anchor-id="data-quality-checks-outliers-and-rare-categories">Data Quality Checks: Outliers and Rare Categories</h3>
<p>Before clustering, we check:</p>
<ul>
<li>outliers in numeric variables,</li>
<li>imbalanced categories in categorical variables.</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cluster_data_2025</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">lab_hba1c</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lab_hba1c</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-lab-hba1c-boxplot" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Boxplot showing the distribution of lab_hba1c values to identify outliers">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-lab-hba1c-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-lab-hba1c-boxplot-1.png" class="img-fluid figure-img" alt="Boxplot showing the distribution of lab_hba1c values to identify outliers" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lab-hba1c-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Boxplot of lab_hba1c
</figcaption></figure>
</div>
</div>
</div>
<p>An inspection of the <strong>lab_hba1c</strong> variable shows that there are no problematic outliers at the lower end of the distribution; therefore, no action is required for low values.</p>
<p>At the <strong>upper end</strong>, however, extreme values are present. To limit their influence, we apply <strong>winsorization</strong>, capping values above Q3 + 1.5 × IQR. This approach reduces the impact of extreme observations while preserving the overall structure of the data.</p>
<p>This step is particularly important because <strong>K-prototypes is sensitive to numeric outliers</strong>: large values inflate Euclidean distances in the numerical component of the algorithm, potentially dominating the mixed (numeric + categorical) dissimilarity measure and leading to distorted cluster assignments. By capping extreme values, we ensure that no single variable disproportionately influences cluster formation, improving both <strong>cluster stability</strong> and <strong>interpretability</strong>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">lab_hba1c</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  4.800   5.400   5.800   6.052   6.300   8.900 </code></pre>
</div>
</div>
<p>The maximum value of <code>lab_hba1c</code> before winsorization is 8.9.</p>
<p>Then we calculate the upper whisker value using the interquartile range (IQR) method.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">lab_hba1c</span>, <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">Q3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">lab_hba1c</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="va">IQR_val</span> <span class="op">&lt;-</span> <span class="va">Q3</span> <span class="op">-</span> <span class="va">Q1</span></span>
<span><span class="va">upper_whisker</span> <span class="op">&lt;-</span> <span class="va">Q3</span> <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="va">IQR_val</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>In summary, <code>winsorizing</code> the <code>lab_hba1c</code> variable helps to mitigate the influence of extreme outliers on the clustering results.</p>
<section id="winsorization-of-lab_hba1c" class="level4"><h4 class="anchored" data-anchor-id="winsorization-of-lab_hba1c">Winsorization of lab_hba1c</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Save the original values</span></span>
<span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">lab_hba1c_original</span> <span class="op">&lt;-</span> <span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">lab_hba1c</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We use <code><a href="https://rdrr.io/r/base/Extremes.html">pmin()</a></code> function to force the <code>lab_hba1c</code> outliers to equal the <code>upper whisker value</code>, it selects the minimum out of: the existing lab_hba1c value and the upper whisker value.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">lab_hba1c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">lab_hba1c</span>, <span class="va">upper_whisker</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>After winsorization - <strong>where did the outliers go?</strong> They are now all at the upper whisker.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">lab_hba1c</span>, </span>
<span>        main <span class="op">=</span> <span class="st">"lab_hba1c – After Winsorization"</span>,</span>
<span>        horizontal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-lab-hba1c-boxplot-winsorized" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Boxplot showing the distribution of lab_hba1c values after winsorization to identify outliers">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-lab-hba1c-boxplot-winsorized-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-lab-hba1c-boxplot-winsorized-1.png" class="img-fluid figure-img" alt="Boxplot showing the distribution of lab_hba1c values after winsorization to identify outliers" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lab-hba1c-boxplot-winsorized-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Boxplot of lab_hba1c After Winsorization
</figcaption></figure>
</div>
</div>
</div>
</section><section id="unbalanced-categorical-features" class="level4"><h4 class="anchored" data-anchor-id="unbalanced-categorical-features">Unbalanced categorical features</h4>
<p>We check the distribution of categories in each categorical variable to ensure there are no extremely rare categories that could distort clustering.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cat_balance</span> <span class="op">&lt;-</span> <span class="va">cluster_data_2025</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">select_if</a></span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"variable"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"category"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">category</span>, name <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>         is_rare <span class="op">=</span> <span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">variable</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cat_balance</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 5
   variable  category          n   pct is_rare
   &lt;chr&gt;     &lt;fct&gt;         &lt;int&gt; &lt;dbl&gt; &lt;lgl&gt;  
 1 age_group 40–49            88  35.2 FALSE  
 2 age_group 50–59            87  34.8 FALSE  
 3 age_group 60+              75  30   FALSE  
 4 bmi_cat   Normal weight   102  40.8 FALSE  
 5 bmi_cat   Overweight       78  31.2 FALSE  
 6 bmi_cat   Obesity          46  18.4 FALSE  
 7 bmi_cat   Underweight      24   9.6 FALSE  
 8 country   Brazil           67  26.8 FALSE  
 9 country   China            50  20   FALSE  
10 country   Italy            50  20   FALSE  
# ℹ 15 more rows</code></pre>
</div>
</div>
<p>None of the categorical variables used as <strong>input features for clustering</strong> are extremely rare (i.e., less than <span class="math inline">\(5\%\)</span> of the total), so all can be retained in the clustering process. If a rare input category had been present, it would have been necessary to regroup it into a broader or “other” category to avoid sparsity, as very small categories can introduce noise and instability in distance calculations when categorical mismatches directly contribute to dissimilarity.</p>
<p>Although a category within the <strong>outcome variable</strong> (gestational diabetes) is rare, this variable is <strong>not used as an input to the clustering algorithm</strong> and therefore does not affect distance computation or cluster formation. Outcome variables are analysed <strong>post hoc</strong>, to characterise and interpret the resulting clusters rather than to define them. As a result, rarity in an outcome category does not pose the same methodological concerns as rarity in input features.</p>
</section><section id="scaling-numeric-variables-and-final-variable-selection" class="level4"><h4 class="anchored" data-anchor-id="scaling-numeric-variables-and-final-variable-selection">Scaling Numeric Variables and Final Variable Selection</h4>
<p>Why scaling? Scaling numeric variables ensures that they contribute equally to the distance calculations used in clustering. Without scaling, variables with larger ranges can dominate the distance metric, leading to biased clustering results.</p>
<p>We then retain the final set of variables for clustering and standardise the numeric input.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cluster_data_2025</span> <span class="op">&lt;-</span> <span class="va">cluster_data_2025</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">lab_hba1c</span>,</span>
<span>         <span class="va">sex</span>,</span>
<span>         <span class="va">age_group</span>,</span>
<span>         <span class="va">bmi_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># here is where scaling happens</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lab_hba1c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">lab_hba1c</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="choosing-the-number-of-clusters" class="level3"><h3 class="anchored" data-anchor-id="choosing-the-number-of-clusters">Choosing the Number of Clusters</h3>
<p>We use the elbow method, examining how within-cluster variation decreases as the number of clusters increases. What we do here is <code>run the k-prototypes algorithm</code> for a <code>range of cluster numbers (k = 2 to 10)</code> and record the total <code>within-cluster sum of squares (WSS)</code> for each k. We use the <code>map_dbl</code> function from the <code>purrr</code> package to map over the range of k values and store the WSS results. And the <code>kproto</code> function from the <code>clustMixType</code> package to perform k-prototypes clustering on the prepared dataset for 2025.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">kproto_wss_2025</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">kpres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/clustMixType/man/kproto.html">kproto</a></span><span class="op">(</span><span class="va">cluster_data_2025</span>,</span>
<span>                  <span class="va">k</span>, </span>
<span>                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span>    </span>
<span>  <span class="va">kpres</span><span class="op">$</span><span class="va">tot.withinss</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>And plot the <strong>WSS values</strong> to identify the “elbow” point where adding more clusters yields diminishing returns in reducing WSS.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">10</span>, <span class="va">kproto_wss_2025</span>, type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Number of clusters (k)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Total within-cluster sum of squares"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Elbow Method (2025)"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-elbow-2025" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Line plot showing the total within-cluster sum of squares for different numbers of clusters (k) to identify the optimal number of clusters using the elbow method">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-elbow-2025-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-elbow-2025-1.png" class="img-fluid figure-img" alt="Line plot showing the total within-cluster sum of squares for different numbers of clusters (k) to identify the optimal number of clusters using the elbow method" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-elbow-2025-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Elbow Method to Determine Optimal Number of Clusters (2025)
</figcaption></figure>
</div>
</div>
</div>
<p>Based on the elbow plot, we choose <code>k = 5</code> as the optimal number of clusters.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">optimal_k</span> <span class="op">&lt;-</span> <span class="fl">5</span>  <span class="co"># chosen from elbow</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="run-k-prototypes-clustering" class="level3"><h3 class="anchored" data-anchor-id="run-k-prototypes-clustering">Run K-prototypes Clustering</h3>
<p>We use the <code>kproto</code> function again, but this time specifying the <code>optimal number of clusters (k = 5)</code> determined from the elbow method. We set a random seed for reproducibility, and configure the algorithm to run with 25 random starts and a maximum of 25 iterations per start to ensure convergence.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">567</span><span class="op">)</span></span>
<span><span class="va">kp_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/clustMixType/man/kproto.html">kproto</a></span><span class="op">(</span><span class="va">cluster_data_2025</span>, </span>
<span>                   k <span class="op">=</span> <span class="va">optimal_k</span>,</span>
<span>                   nstart <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                   iter.max <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                   lambda <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The model has now assigned a cluster number to each datapoint, found in kp_model$cluster. We add each datapoint’s cluster number (1 to 5) to the dataset:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="va">kp_model</span><span class="op">$</span><span class="va">cluster</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="interpreting-the-clusters" class="level4"><h4 class="anchored" data-anchor-id="interpreting-the-clusters">Interpreting the Clusters</h4>
<p>Key diagnostic outputs help assess clustering quality and interpretability:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kp_model</span><span class="op">$</span><span class="va">size</span> <span class="co"># Number of points in each cluster</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>clusters
 1  2  3  4  5 
40 60 55 43 52 </code></pre>
</div>
</div>
<p>We are primarily checking for <strong>extreme imbalance in cluster sizes</strong>. Clusters containing a very small proportion of observations (e.g., &lt; 5% of the total sample) may indicate unstable or noise-driven groupings, while a single dominant cluster (e.g., &gt; 60–70% of all observations) can suggest that the chosen number of clusters <em>k</em> is too small or that important structure in the data is being missed.</p>
<p>A <strong>reasonably balanced distribution</strong>, with clusters large enough to be meaningful but still distinct in size, is generally desirable. Some asymmetry is expected in real-world data; however, the absence of tiny “degenerate” clusters increases confidence that the clustering solution is both <strong>stable</strong> and <strong>interpretable</strong>, rather than driven by outliers or rare patterns.</p>
<p>Lambda balances numerical (Euclidean) vs categorical (matching) distance:</p>
<p><span id="eq-lambda"><span class="math display">\[
\lambda =\sum{\frac{\text{Std Dev of numerical features}}{\text{numerical features}}}
\tag{3}\]</span></span></p>
<p>Calculate lambda manually to verify:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kp_model</span><span class="op">$</span><span class="va">lambda</span> <span class="co"># Lambda value used</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.614542</code></pre>
</div>
</div>
<p>The <code>withinss</code> value, the <strong>within-cluster sum of squares</strong>, measures how <strong>compact</strong> each cluster is. Lower values indicate greater compactness, meaning that observations within the cluster are more similar to each other with respect to the numerical variables used in the model.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kp_model</span><span class="op">$</span><span class="va">withinss</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  52.14029  82.26258 102.81009 114.58939  80.15626</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Compare cluster compactness</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">kp_model</span><span class="op">$</span><span class="va">withinss</span>, </span>
<span>        names.arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Cluster"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>        ylab <span class="op">=</span> <span class="st">"Within-cluster SS"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Cluster Compactness (lower = more compact)"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-cluster-compactness" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Bar plot showing the within-cluster sum of squares for each cluster to assess cluster compactness">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-cluster-compactness-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-cluster-compactness-1.png" class="img-fluid figure-img" alt="Bar plot showing the within-cluster sum of squares for each cluster to assess cluster compactness" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cluster-compactness-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Cluster Compactness (2025)
</figcaption></figure>
</div>
</div>
</div>
<p>The total <code>within-cluster sum of squares</code> represents the overall compactness. When we did the elbow plot, we were looking at how this total changes as we add more clusters. We want tight clusters without over-fragmenting our data.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kp_model</span><span class="op">$</span><span class="va">tot.withinss</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 431.9586</code></pre>
</div>
</div>
<p>The cluster centres for categorical variables represent modal categories, while numeric centres reflect mean values.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kp_model</span><span class="op">$</span><span class="va">centers</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   lab_hba1c   sex age_group       bmi_cat
1 -0.4989520   men     50–59    Overweight
2 -0.1045277 woman     50–59 Normal weight
3 -0.5085203 woman     40–49    Overweight
4  1.8296915   men     40–49 Normal weight
5 -0.4707380   men       60+ Normal weight</code></pre>
</div>
</div>
<p>To better understand the numerical values of lab_hba1c, we undo the scaling of the numerical column, using the standard deviation and mean calculated earlier (see Summary Statistics):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cluster_data_2025</span><span class="op">[</span><span class="st">'lab_hba1c_unscaled'</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span><span class="va">cluster_data_2025</span><span class="op">[</span><span class="st">'lab_hba1c'</span><span class="op">]</span> <span class="op">*</span> <span class="fl">0.92</span><span class="op">)</span> <span class="op">+</span> <span class="fl">5.96</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now we can obtain a better understanding of each cluster:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cluster_data_2025</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    hba1c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lab_hba1c_unscaled</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    bmi_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">bmi_cat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  cluster     n hba1c sex   bmi_cat       age  
    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;
1       1    40   5.5 men   Overweight    50–59
2       2    60   5.9 woman Normal weight 50–59
3       3    55   5.5 woman Overweight    40–49
4       4    43   7.6 men   Normal weight 40–49
5       5    52   5.5 men   Normal weight 60+  </code></pre>
</div>
</div>
<p><strong>Cluster 1</strong> (n=46): Men, normal weight, ages 40-49, HbA1c 7.6%<br>
Middle-aged men with healthy weight and but diabetic range blood sugar (lean male diabetics)<br><strong>Cluster 1 is the danger zone</strong> - lean men with diabetes (often associated with worse outcomes)</p>
<p><strong>Cluster 2</strong> (n=50): Men, normal weight, ages 60+, HbA1c 5.4%<br>
Older men with healthy weight and normal blood sugar</p>
<p><strong>Cluster 3</strong> (n=45): Women, obesity, ages 40-49, HbA1c 5.5%<br>
Middle-aged obese women with normal HbA1c (relatively well-controlled despite obesity) Cluster 3 shows metabolic resilience despite obesity</p>
<p><strong>Cluster 4</strong> (n=52): Men, overweight, ages 50-59, HbA1c 5.5%<br>
Middle-aged overweight men with normal HbA1c</p>
<p><strong>Cluster 5</strong> (n=57): Women, normal weight, ages 50-59, HbA1c 5.9% - Middle-aged women with normal weight but borderline prediabetic HbA1c</p>
<div class="callout callout-style-simple callout-note callout-titled" title="Interpretation">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Interpretation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Synthesised data! The algorithm successfully separated groups by the interaction of categorical (sex, BMI category, age group) and continuous (HbA1c) variables.</p>
</div>
</div>
</section></section><section id="external-validation-using-diabetes-status" class="level3"><h3 class="anchored" data-anchor-id="external-validation-using-diabetes-status">External Validation Using Diabetes Status</h3>
<p>Although clustering is unsupervised, we can validate the result externally by checking whether clusters align with known diabetes status.</p>
<p>Add diabetes status back to cluster data:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">diabetes</span> <span class="op">&lt;-</span> <span class="va">df_diabetes_2025</span><span class="op">$</span><span class="va">diabetes_total</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/chisq.test.html">chisq.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">diabetes</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  table(cluster_data_2025$cluster, cluster_data_2025$diabetes)
X-squared = 139.77, df = 4, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/assocstats.html">assocstats</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">diabetes</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    X^2 df P(&gt; X^2)
Likelihood Ratio 130.28  4        0
Pearson          139.77  4        0

Phi-Coefficient   : NA 
Contingency Coeff.: 0.599 
Cramer's V        : 0.748 </code></pre>
</div>
</div>
<p>The chi-squared test shows <strong>very strong association</strong> between clusters and diabetes status:</p>
<ul>
<li><p><span class="math inline">\(\chi^2 = 143.72\)</span>, <span class="math inline">\(p&lt; 2.2e-16\)</span> → Highly significant relationship</p></li>
<li><p><span class="math inline">\(\text{Cramer's V} = 0.758\)</span> → Strong effect size (<span class="math inline">\(0.5+\)</span> is considered large)</p></li>
<li><p><span class="math inline">\(\text{Contingency Coefficient} = 0.604\)</span> Confirms strong association</p></li>
</ul>
<p>This demonstrates that the K-prototypes clustering successfully identified clinically meaningful groups that differ significantly in diabetes prevalence. To see this better:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">cluster_data_2025</span><span class="op">$</span><span class="va">diabetes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span>margin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
      no  yes
  1 0.90 0.10
  2 0.85 0.15
  3 0.93 0.07
  4 0.05 0.95
  5 0.92 0.08</code></pre>
</div>
</div>
<p>Practical implication for your clustering workflow:</p>
<p>A Cramér’s V of 0.7477033 strongly suggests these two categorical variables carry overlapping information. If both are included in clustering, the algorithm may effectively <em>double count</em> the same underlying structure, increasing the weight of that dimension in cluster formation.</p>
</section><section id="cluster-quality-silhouette-analysis" class="level3"><h3 class="anchored" data-anchor-id="cluster-quality-silhouette-analysis">Cluster Quality: Silhouette Analysis</h3>
<p><strong>Silhouette analysis</strong> measures how similar an object is to its own cluster compared to other clusters. The silhouette value ranges from -1 to 1, where a value close to 1 indicates that the object is well clustered, a value of 0 indicates that the object is on or very close to the decision boundary between two neighbouring clusters, and negative values indicate that the observation may be closer to a neighbouring cluster than to the one it was assigned to, suggesting possible misclassification.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dist_matrix</span> <span class="op">&lt;-</span> <span class="va">cluster_data_2025</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">cluster</span>, <span class="op">-</span><span class="va">diabetes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/daisy.html">daisy</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"gower"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sil</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html">silhouette</a></span><span class="op">(</span><span class="va">kp_model</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">dist_matrix</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sil</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.211021</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sil</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">optimal_k</span>, </span>
<span>     border <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Silhouette Plot"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-silhouette" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Silhouette plot showing the silhouette values for each observation in the clustering solution">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-silhouette-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-silhouette-1.png" class="img-fluid figure-img" alt="Silhouette plot showing the silhouette values for each observation in the clustering solution" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-silhouette-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Silhouette Plot
</figcaption></figure>
</div>
</div>
</div>
<p>Overall quality: Average width = <span class="math inline">\(0.23\)</span> indicates <strong>Weak structure</strong> (below the <span class="math inline">\(0.25-0.50\)</span> <strong>reasonable</strong> range)</p>
<p><strong>Cluster-specific performance:</strong></p>
<ul>
<li><p><strong>Cluster 1 (0.11)</strong> - Poor separation, many negative values → Members may be misclassified or this cluster is poorly defined</p></li>
<li><p><strong>Clusters 2-4 (0.24-0.25)</strong> - Borderline acceptable</p></li>
<li><p><strong>Cluster 5 (0.30)</strong> - Best separation, but still only moderate</p></li>
</ul>
<p><u>The <strong>silhouette plot</strong> measures clustering quality by calculating how well each observation fits its assigned cluster compared to neighbouring clusters.</u> Ideally, we’d hope for an average silhouette width above 0.5 (indicating reasonable to strong structure), with all positive values showing that observations are closer to their own cluster than to others. ‘Good’ clustering also shows similar widths across all clusters, with wide, uniform bars indicating tight, cohesive groups. This result (average = 0.23) falls below the “weak structure” threshold and includes negative values in Cluster 1, suggesting statistical evidence for poor separation. However, the strong chi-squared association with diabetes (<span class="math inline">\(\chi^2 = 143.72\)</span>, <span class="math inline">\(p &lt; 2.2e-16\)</span>) shows the clusters are clinically meaningful despite low silhouette scores, highlighting the difference between statistical optimisation and domain-relevant pattern discovery in mixed-type data.</p>
</section><section id="boxplots-cluster-compositions" class="level3"><h3 class="anchored" data-anchor-id="boxplots-cluster-compositions">Boxplots &amp; Cluster Compositions</h3>
<p>To better understand the composition of each of the clusters, we can do some simple plots:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_hba1c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cluster_data_2025</span>, </span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span>, </span>
<span>                      y <span class="op">=</span> <span class="va">lab_hba1c_unscaled</span>, </span>
<span>                      fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"HbA1c by Cluster"</span>, </span>
<span>       x <span class="op">=</span> <span class="st">"Cluster"</span>, y <span class="op">=</span> <span class="st">"HbA1c (%)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Age group</span></span>
<span><span class="va">p_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cluster_data_2025</span>, </span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span>, </span>
<span>                    fill <span class="op">=</span> <span class="va">age_group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Age Group"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sex</span></span>
<span><span class="va">p_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cluster_data_2025</span>, </span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span>, </span>
<span>                    fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sex"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># BMI</span></span>
<span><span class="va">p_bmi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cluster_data_2025</span>, </span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span>, </span>
<span>                    fill <span class="op">=</span> <span class="va">bmi_cat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"BMI Category"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_hba1c</span></span>
<span><span class="va">p_age</span></span>
<span><span class="va">p_sex</span></span>
<span><span class="va">p_bmi</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-crosstable" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crosstable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-crosstable" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-crosstable-1" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Crosstab showing the distribution of demographic and clinical variables across different years">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-crosstable-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-crosstable-1.png" class="img-fluid figure-img" data-ref-parent="fig-crosstable" alt="Crosstab showing the distribution of demographic and clinical variables across different years" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-crosstable-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Boxplot showing cluster-wise distribution of HbA1c levels
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-crosstable" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-crosstable-2" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Crosstab showing the distribution of demographic and clinical variables across different years">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-crosstable-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-crosstable-2.png" class="img-fluid figure-img" data-ref-parent="fig-crosstable" alt="Crosstab showing the distribution of demographic and clinical variables across different years" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-crosstable-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Bar plot showing the distribution of age groups across clusters
</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-crosstable" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-crosstable-3" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Crosstab showing the distribution of demographic and clinical variables across different years">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-crosstable-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-crosstable-3.png" class="img-fluid figure-img" data-ref-parent="fig-crosstable" alt="Crosstab showing the distribution of demographic and clinical variables across different years" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-crosstable-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Bar plot showing the distribution of sex across clusters
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-crosstable" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-crosstable-4" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Crosstab showing the distribution of demographic and clinical variables across different years">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-crosstable-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-exploring-diabetes-data_files/figure-html/fig-crosstable-4.png" class="img-fluid figure-img" data-ref-parent="fig-crosstable" alt="Crosstab showing the distribution of demographic and clinical variables across different years" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-crosstable-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Bar plot showing the distribution of BMI categories across clusters
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crosstable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Crosstab of Demographic and Clinical Variables by Year
</figcaption></figure>
</div>
</section><section id="key-clinical-insights" class="level3"><h3 class="anchored" data-anchor-id="key-clinical-insights">Key Clinical Insights:</h3>
<p>The k-prototypes clustering reveals clinically interpretable subgroups within the 2025 population, reflecting distinct metabolic profiles rather than arbitrary partitions.</p>
<p><code>Cluster 4</code> concentrates individuals with clearly <code>elevated HbA1c</code> levels (mean ≈ 8%), corresponding to the diagnosed diabetic population, although separation from neighbouring clusters is weaker than for some other groups.</p>
<p><code>Cluster 5</code> represents a pre-diabetic risk profile, characterised by younger individuals—predominantly women—who may benefit from early monitoring and preventive intervention.</p>
<p><code>Clusters 1–3</code> capture different non-diabetic phenotypes with broadly healthy metabolic profiles and varying demographic compositions.</p>
<p>Overall, the clustering distinguishes diabetic from non-diabetic individuals in a meaningful way, as supported by external validation using diabetes status, while also highlighting substantial overlap consistent with diabetes risk existing along a continuum rather than as discrete categories.</p>
<p>This analysis suggests that diabetes risk may vary systematically with age, sex, and BMI, highlighting the potential relevance of stratified screening approaches. However, given that the data are simulated, these findings are intended to be illustrative and should not be interpreted as clinical evidence.</p>
</section></section><section id="bonus" class="level2"><h2 class="anchored" data-anchor-id="bonus">Bonus</h2>
<section id="frequency-table-for-bmi-categories" class="level3"><h3 class="anchored" data-anchor-id="frequency-table-for-bmi-categories">Frequency Table for BMI Categories</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://danchaltiel.github.io/crosstable/reference/crosstable.html">crosstable</a></span><span class="op">(</span><span class="va">df_diabetes</span>, by <span class="op">=</span> <span class="st">"year"</span>, </span>
<span>           cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sex"</span>,<span class="st">"diabetes_total"</span>,</span>
<span>                    <span class="st">"bmi_cat"</span>,<span class="st">"country"</span>,<span class="st">"sdi"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/as_flextable.html">as_flextable</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-9acd4112{table-layout:auto;}.cl-9ac452b4{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9ac452c8{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9ac88820{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9ac8882a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9ac8a242{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(0, 0, 0, 1.00);border-top: 1.5pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9ac8a243{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1.5pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9ac8a24c{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9ac8a24d{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9ac8a256{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9ac8a257{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9ac8a258{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9ac8a260{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9ac8a26a{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-9acd4112">
<thead>
<tr style="overflow-wrap:break-word;">
<th rowspan="2" class="cl-9ac8a242"><p class="cl-9ac88820"><span class="cl-9ac452b4">label</span></p></th>
<th rowspan="2" class="cl-9ac8a242"><p class="cl-9ac88820"><span class="cl-9ac452b4">variable</span></p></th>
<th colspan="2" class="cl-9ac8a243"><p class="cl-9ac88820"><span class="cl-9ac452b4">year</span></p></th>
</tr>
<tr style="overflow-wrap:break-word;">
<th class="cl-9ac8a24c"><p class="cl-9ac88820"><span class="cl-9ac452b4">2015</span></p></th>
<th class="cl-9ac8a24c"><p class="cl-9ac88820"><span class="cl-9ac452b4">2025</span></p></th>
</tr>
</thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">sex</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">men</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">125 (50.00%)</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">125 (50.00%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">woman</span></p></td>
<td class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">125 (50.00%)</span></p></td>
<td class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">125 (50.00%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-9ac8a257"><p class="cl-9ac8882a"><span class="cl-9ac452c8">diabetes_total</span></p></td>
<td class="cl-9ac8a258"><p class="cl-9ac8882a"><span class="cl-9ac452c8">no</span></p></td>
<td class="cl-9ac8a258"><p class="cl-9ac8882a"><span class="cl-9ac452c8">212 (53.00%)</span></p></td>
<td class="cl-9ac8a258"><p class="cl-9ac8882a"><span class="cl-9ac452c8">188 (47.00%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">yes</span></p></td>
<td class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">38 (38.00%)</span></p></td>
<td class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">62 (62.00%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="4" class="cl-9ac8a257"><p class="cl-9ac8882a"><span class="cl-9ac452c8">bmi_cat</span></p></td>
<td class="cl-9ac8a258"><p class="cl-9ac8882a"><span class="cl-9ac452c8">Normal weight</span></p></td>
<td class="cl-9ac8a258"><p class="cl-9ac8882a"><span class="cl-9ac452c8">95 (48.22%)</span></p></td>
<td class="cl-9ac8a258"><p class="cl-9ac8882a"><span class="cl-9ac452c8">102 (51.78%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">Obesity</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">56 (54.90%)</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">46 (45.10%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">Overweight</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">85 (52.15%)</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">78 (47.85%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">Underweight</span></p></td>
<td class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">14 (36.84%)</span></p></td>
<td class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">24 (63.16%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="5" class="cl-9ac8a257"><p class="cl-9ac8882a"><span class="cl-9ac452c8">country</span></p></td>
<td class="cl-9ac8a258"><p class="cl-9ac8882a"><span class="cl-9ac452c8">Brazil</span></p></td>
<td class="cl-9ac8a258"><p class="cl-9ac8882a"><span class="cl-9ac452c8">33 (33.00%)</span></p></td>
<td class="cl-9ac8a258"><p class="cl-9ac8882a"><span class="cl-9ac452c8">67 (67.00%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">China</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">66 (56.90%)</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">50 (43.10%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">Italy</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">34 (40.48%)</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">50 (59.52%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">South Africa</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">67 (67.00%)</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">33 (33.00%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">USA</span></p></td>
<td class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">50 (50.00%)</span></p></td>
<td class="cl-9ac8a24d"><p class="cl-9ac8882a"><span class="cl-9ac452c8">50 (50.00%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="3" class="cl-9ac8a260"><p class="cl-9ac8882a"><span class="cl-9ac452c8">sdi</span></p></td>
<td class="cl-9ac8a258"><p class="cl-9ac8882a"><span class="cl-9ac452c8">High</span></p></td>
<td class="cl-9ac8a258"><p class="cl-9ac8882a"><span class="cl-9ac452c8">100 (50.00%)</span></p></td>
<td class="cl-9ac8a258"><p class="cl-9ac8882a"><span class="cl-9ac452c8">100 (50.00%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">Intermediate</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">100 (50.00%)</span></p></td>
<td class="cl-9ac8a256"><p class="cl-9ac8882a"><span class="cl-9ac452c8">100 (50.00%)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-9ac8a26a"><p class="cl-9ac8882a"><span class="cl-9ac452c8">Low</span></p></td>
<td class="cl-9ac8a26a"><p class="cl-9ac8882a"><span class="cl-9ac452c8">50 (50.00%)</span></p></td>
<td class="cl-9ac8a26a"><p class="cl-9ac8882a"><span class="cl-9ac452c8">50 (50.00%)</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="bmi-categories-by-year" class="level3"><h3 class="anchored" data-anchor-id="bmi-categories-by-year">BMI Categories by Year</h3>
<p>The distribution of BMI categories by year can be examined using counts and proportions.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_diabetes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">bmi_cat</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
# Groups:   year [2]
   year bmi_cat           n  prop
  &lt;dbl&gt; &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt;
1  2015 Normal weight    95 0.38 
2  2015 Obesity          56 0.224
3  2015 Overweight       85 0.34 
4  2015 Underweight      14 0.056
5  2025 Normal weight   102 0.408
6  2025 Obesity          46 0.184
7  2025 Overweight       78 0.312
8  2025 Underweight      24 0.096</code></pre>
</div>
</div>
</section><section id="visualizing-bmi-categories-by-year" class="level3"><h3 class="anchored" data-anchor-id="visualizing-bmi-categories-by-year">Visualizing BMI Categories by Year</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_diabetes</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bmi_cat</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"BMI categories by year"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"BMI category"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-exploring-diabetes-data_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="proportional-distribution-of-bmi-categories-by-year" class="level3"><h3 class="anchored" data-anchor-id="proportional-distribution-of-bmi-categories-by-year">Proportional Distribution of BMI Categories by Year</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_diabetes</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bmi_cat</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"BMI categories by year (proportions)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"BMI category"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Proportion"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-exploring-diabetes-data_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section></section><a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>Global, regional, and national cascades of diabetes care, 2000–23: a systematic review and modelling analysis using findings from the Global Burden of Disease Study, Stafford, Lauryn K et al.&nbsp;The Lancet Diabetes &amp; Endocrinology, Volume 13, Issue 11, 924 - 934 (<a href="https://doi.org/10.1016/S2213-8587(25)00217-7" class="uri">https://doi.org/10.1016/S2213-8587(25)00217-7</a>)<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Burden of 375 diseases and injuries, risk-attributable burden of 88 risk factors, and healthy life expectancy in 204 countries and territories, including 660 subnational locations, 1990–2023: a systematic analysis for the Global Burden of Disease Study 2023 Hay, Simon I et al.&nbsp;The Lancet, Volume 406, Issue 10513, 1873 - 1922 (<a href="https://doi.org/10.1016/S0140-6736(25)01637-X" class="uri">https://doi.org/10.1016/S0140-6736(25)01637-X</a>)<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/rladiesrome\.github\.io\/Principles-of-data-Analysis-in-R");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./01-getting-started.html" class="pagination-link" aria-label="2. Getting Started">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">2. Getting Started</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright © 2025 <a href="https://www.rladiesrome.org/">RLadiesRome Learning | RConsortium</a><br> Designer &amp; Maintainer: <a href="https://github.com/Fgazzelloni">Federica Gazzelloni</a><br> Powered by: <a href="https://quarto.org/">Quarto &amp; GitHub Pages | </a><a href="./LICENSE.html">MIT License.</a></p>
</div>   
    <div class="nav-footer-center">
<p><a href="https://www.rladiesrome.org/" target="_blank"> <img src="images/rconsortium.png" alt="rconsortium logo" style="height:60px;"></a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/rladiesrome/Principles-of-data-Analysis-in-R/edit/main/02-exploring-diabetes-data.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/rladiesrome/Principles-of-data-Analysis-in-R/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rladiesrome/Exploring-Diabetes-Data">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/company/rladiesrome">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.rladies.org/">
      <i class="bi bi-globe" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:rome@rladies.com">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>