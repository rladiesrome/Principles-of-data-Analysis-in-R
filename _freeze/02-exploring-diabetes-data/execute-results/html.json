{
  "hash": "16c196dd3ff69ac744b5b690d6f66fe0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"From Basics to Advanced Health Analytics: Exploring Diabetes Data\"\nsubtitle: \"An Exploratory Data Analysis (EDA) Tutorial\"\nauthor: \"Rafaela Ribeiro Lucas, Federica Gazzelloni, and Lucy Michaels \"\ndate: \"17 December, 2025\"\ndescription: |\n  This tutorial demonstrates exploratory data analysis (EDA) techniques on a simulated diabetes dataset for the years 2015 and 2025, covering data import, pre-processing, visualization, summary statistics, prevalence calculation, and statistical inference.\ncategories: [Tutorials, EDA, Diabetes, R Ladies Rome]\ntags: [R, EDA, Diabetes, Data Analysis, Statistics]\nexecute:\n  echo: true\n  warning: false\n  message: false\nformat:\n  html:\n    code-copy: true\n    toc: true\n    toc-location: right\n---\n\n## Overview\n\nIn this session, we perform an exploratory data analysis on a simulated diabetes dataset for 2015 and 2025. The dataset used in this tutorial is **simulated**, this means that the 2015 and 2025 data are **not real patient records** and are **not drawn from GBD estimates or surveillance systems**. Instead, they consist of synthetic data designed to resemble realistic diabetes patterns over time, including changes in prevalence, laboratory measurements, and population structure.\n\nThe use of simulated data allows the analysis to focus on **methodology**, **workflow**, and **interpretation**, without privacy constraints or data access limitations. All results should therefore be interpreted as illustrative examples of analytical techniques rather than as epidemiological estimates.\n\nTo explore how diabetes prevalence and characteristics vary over time and across populations, in this tutorial we will cover:\n\n-   Data Import\n-   Pre-processing\n-   Exploratory Data Visualization (EDA)\n-   Summary Statistics\n-   Prevalence Calculation\n-   Qualitative Statistical Inference\n\n\n> Why Diabetes?\n\nDiabetes is a chronic health condition that affects how the body turns food into energy (blood glucose). It includes **Type 1**, **Type 2**, and **gestational diabetes**. The dataset used in this analysis contains information on individuals' `diabetes status`, `laboratory measurements` (such as HbA1c levels), `demographic information` (age, sex, country), and `other health-related variables`.\n\nAt the population level, diabetes is a major contributor to illness (`morbidity`) and premature death (`mortality`). Classified as a **non-communicable disease (NCD)**, it is associated with various complications, including `cardiovascular disease`, `kidney failure`, and `neuropathy.`\n\n### Research in Context\n\nThe **Global Burden of Disease (GBD)** study often identifies diabetes as a key driver of global health loss. According to **GBD 2023** estimates, approximately **561 million people** were living with diabetes worldwide in **2023**, which is roughly $7\\%$ of the world’s population (561 million out of $~8$ billion).[^1] In the same year, diabetes accounted for about **90.2 million disability-adjusted life years (DALYs)** globally, representing approximately $3.2\\%$ of total global DALYs. Diabetes also contributed substantially to non-fatal health loss, with an estimated **44.2 million years lived with disability (YLDs)** in 2023, representing about $4.5\\%$ of all global YLDs.[^2]\n\n[^1]: Global, regional, and national cascades of diabetes care, 2000–23: a systematic review and modelling analysis using findings from the Global Burden of Disease Study, Stafford, Lauryn K et al. The Lancet Diabetes & Endocrinology, Volume 13, Issue 11, 924 - 934 (<https://doi.org/10.1016/S2213-8587(25)00217-7>)\n\n[^2]: Burden of 375 diseases and injuries, risk-attributable burden of 88 risk factors, and healthy life expectancy in 204 countries and territories, including 660 subnational locations, 1990–2023: a systematic analysis for the Global Burden of Disease Study 2023 Hay, Simon I et al. The Lancet, Volume 406, Issue 10513, 1873 - 1922 (<https://doi.org/10.1016/S0140-6736(25)01637-X>)\n\nFrom an analytical perspective, diabetes is commonly studied using measures such as `prevalence rates,` `risk factors`, and `associations with other health conditions`. Typical statistical tools include `descriptive statistics`, `hypothesis testing` (e.g., chi-square tests for categorical variables) for group comparisons, and exploratory methods such as `clustering`, `regression analysis`, and, in some settings, `survival analysis`.\n\n### Research Questions\n\nTo focus the analysis, we begin by defining the research questions addressed in this tutorial:\n\n> 1.  Has the prevalence of diabetes changed significantly between 2015 and 2025?\n\n> 2.  Does the prevalence of diabetes differ significantly between countries in the year 2025?\n\n## Packages\n\nBefore we start, we load a small set of packages.\n\n### Install Required Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(c(\"readxl\", \"janitor\", \"tidyverse\", \n                   \"scales\", \"crosstable\"))\n```\n:::\n\n\n### Load Required Libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\nlibrary(janitor)\nlibrary(tidyverse)\nlibrary(scales)\nlibrary(crosstable)\n```\n:::\n\n\n\n\n## Data Import\n\nData are stored in one Excel file with two sheets: one for 2015 and one for 2025. We read each sheet into R and clean the column names so they are consistent and easy to type.\n\nWe use the `read_excel` function from the `readxl` package to read the data and the `clean_names` function from the `janitor` package to clean the column names.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npath <- \"data/diabetes_study_filled.xlsx\"\n\nd2015 <- readxl::read_excel(path, \n                            sheet = \"2015\") |> \n  janitor::clean_names()\nd2025 <- readxl::read_excel(path, \n                            sheet = \"2025\") |> \n  janitor::clean_names()\n```\n:::\n\n\n## Pre-processing\n\nThe pre-processing phase is crucial for ensuring the quality and integrity of the data before conducting any analysis. Data are often messy and may contain **inconsistencies**, **missing values**, or **irrelevant information** that can affect the results of the analysis.\n\n### Data Manipulation\n\nCombine data for comparative analyses by year is straightforward, we *stack* the two datasets into a single table and add a year column. This is **data manipulation**; we merge the two datasets from 2015 and 2025 into a single dataset, adding a new column to indicate the year of each observation.\n\nIn particular, we use the `bind_rows` function from the `dplyr` package to stack the two datasets vertically, and the `mutate` function to create a new column called `year`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_raw <- bind_rows(\n  d2015 |> mutate(year = 2015),\n  d2025 |> mutate(year = 2025))\n```\n:::\n\n\n### Data Inspection\n\nThe first step is to check the initial structure of the data and identify any missing values. We can use the `head` function to view the first few rows of the dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Checking initial structure\nhead(data_raw)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 9\n   year country   age sex   bmi_cat       sdi     lab_hba1c diabetes_self_report\n  <dbl> <chr>   <dbl> <chr> <chr>         <chr>       <dbl> <chr>               \n1  2015 Brazil     42 woman Obesity       Interm…       4.9 no                  \n2  2015 Brazil     64 woman Normal weight Interm…       6.1 no                  \n3  2015 Brazil     82 woman Obesity       Interm…       4.8 no                  \n4  2015 Brazil     55 woman Normal weight Interm…       6   no                  \n5  2015 Brazil     59 woman Underweight   Interm…       5.6 no                  \n6  2015 Brazil     42 men   Normal weight Interm…       6.3 no                  \n# ℹ 1 more variable: gestational_diabetes <chr>\n```\n\n\n:::\n:::\n\n\nThen, we perform data inspection with the `str` or `glimpse` functions to understand the data types and structure of each variable. Both functions provide a concise summary of the dataset, including the number of observations, variables, and their respective data types.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(data_raw)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 500\nColumns: 9\n$ year                 <dbl> 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2…\n$ country              <chr> \"Brazil\", \"Brazil\", \"Brazil\", \"Brazil\", \"Brazil\",…\n$ age                  <dbl> 42, 64, 82, 55, 59, 42, 54, 51, 73, 66, 54, 65, 4…\n$ sex                  <chr> \"woman\", \"woman\", \"woman\", \"woman\", \"woman\", \"men…\n$ bmi_cat              <chr> \"Obesity\", \"Normal weight\", \"Obesity\", \"Normal we…\n$ sdi                  <chr> \"Intermediate\", \"Intermediate\", \"Intermediate\", \"…\n$ lab_hba1c            <dbl> 4.9, 6.1, 4.8, 6.0, 5.6, 6.3, 5.2, 5.8, 6.2, 6.0,…\n$ diabetes_self_report <chr> \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"…\n$ gestational_diabetes <chr> \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"…\n```\n\n\n:::\n:::\n\n\n### Handling Missing Values\n\nNext, we check for missing values (NA) with `is.na` function. This function returns a logical matrix indicating the presence of missing values in the dataset. To count the number of missing values in each column, we can use the `colSums` function in combination with `is.na`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Checking missing values (NA)\ncolSums(is.na(data_raw))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                year              country                  age \n                   0                    0                    0 \n                 sex              bmi_cat                  sdi \n                   0                    0                    0 \n           lab_hba1c diabetes_self_report gestational_diabetes \n                   0                    0                    0 \n```\n\n\n:::\n:::\n\n\nThere aren't missing values in the dataset, but if there were, we could handle them using various strategies such as `imputation`, `removal`, or `flagging`, depending on the nature and extent of the missing data.\n\n::: {.callout-note appearance=\"simple\" title=\"Question\"}\nHow would you handle missing values in a dataset? What strategies would you consider?\n:::\n\n### Creating Derived Variables\n\nData are usually not in the exact format needed for analysis. Therefore, we create new variables based on existing ones to facilitate the analysis. We are looking at making comparisons between two years to see how diabetes level changes along the time.\n\nIn this case , we create three derived variables:\n\n-   Laboratory-defined diabetes (HbA1c ≥ 6.5)\n-   Total diabetes (self-report OR laboratory, excluding gestational diabetes)\n-   Age groups (set of age bands to support grouped summaries)\n\nThis step involves using the `mutate` function from the `dplyr` package to create new columns based on conditions applied to existing columns. And we use the `if_else` and `case_when` functions to define the logic for these new variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiabetes_data <- data_raw |>\n  mutate(\n    diabetes_lab = if_else(lab_hba1c >= 6.5, \"yes\", \"no\", missing = NA_character_),\n    diabetes_total = case_when(\n      gestational_diabetes == \"yes\" ~ \"no\",\n      diabetes_self_report == \"yes\" | diabetes_lab == \"yes\" ~ \"yes\",\n      TRUE ~ \"no\"\n    ),\n    age_group = case_when(\n      age < 50 ~ \"40–49\",\n      age < 60 ~ \"50–59\",\n      TRUE ~ \"60+\"\n    )\n  )\n```\n:::\n\n\n## Exploratory data Analysis (EDA)\n\nExploratory Data Analysis (EDA) is a crucial step in understanding the underlying patterns, relationships, and distributions within a dataset. It involves using various statistical and graphical techniques to summarize and visualize the data. EDA helps to identify potential issues, outliers, and trends that may inform subsequent analyses or modelling efforts. \n\n### Distribution plot for HbA1c (2015 only)\n\nLet's visualize the distribution of HbA1c levels for the year 2015 using a histogram combined with a density plot. This will help us understand the spread and central tendency of HbA1c values in that year.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = d2015, \n       aes(x = lab_hba1c)) +\n  geom_histogram(aes(y = after_stat(density)), \n                 bins = 30,\n                 fill = \"lightblue\", \n                 color = \"grey70\") +\n  geom_density(color = \"darkblue\", \n               linewidth = 1) +\n  labs(title = \"HbA1c Distribution (2015)\",\n       x = \"HbA1c (%)\",\n       y = \"Density\") \n```\n\n::: {.cell-output-display}\n![](02-exploring-diabetes-data_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n### HbA1c distribution in both years\n\nTo compare the distribution of **HbA1c levels between 2015 and 2025**, we can create a density plot that overlays the distributions for both years. This will allow us to visually assess any changes in HbA1c levels over time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiabetes_data %>%\n  ggplot(aes(x = lab_hba1c, \n           fill = as.factor(year))) +\n  geom_density(alpha = 0.5) +\n  labs(title = \"HbA1c Distribution — 2015 vs 2025\",\n       x = \"HbA1c (%)\",\n       y = \"Density\",\n       fill = \"Year\")\n```\n\n::: {.cell-output-display}\n![](02-exploring-diabetes-data_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n### Age distribution by year\n\nTo check the age distribution for both years, we can create overlapping histograms. This will help us visualize how the age distribution of the population has changed from 2015 to 2025.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = diabetes_data,\n       mapping = aes(x = age, \n                     fill = factor(year))) +\n  geom_histogram(position = \"identity\", \n                 alpha = 0.5, bins = 30) +\n  labs(title = \"Age Distribution: 2015 vs 2025\",\n       fill = \"Year\",\n       x = \"Age\",\n       y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](02-exploring-diabetes-data_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n### Age Boxplots\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diabetes_data,\n       aes(x = factor(year), y = age, \n           fill = factor(year))) +\n  geom_boxplot() +\n  facet_wrap(~sex) +\n  labs(title = \"Age Distribution by Year\",\n       x = \"Year\",\n       y = \"Age\",\n       fill = \"Year\") \n```\n\n::: {.cell-output-display}\n![](02-exploring-diabetes-data_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n## Summary Statistics\n\nNow that we have explored the data visually, we can compute some summary statistics to quantify key characteristics of the dataset, and compare them across the two years. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiabetes_data |>\n  summarise(\n    n = n(),\n    age_mean = mean(age, na.rm = TRUE),\n    age_sd   = sd(age, na.rm = TRUE),\n    hba1c_mean = mean(lab_hba1c, na.rm = TRUE),\n    hba1c_sd   = sd(lab_hba1c, na.rm = TRUE)\n    ) %>%\n  round(2) %>%\n  t()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             [,1]\nn          500.00\nage_mean    56.34\nage_sd      11.86\nhba1c_mean   5.96\nhba1c_sd     0.92\n```\n\n\n:::\n:::\n\n\nThe results show the overall mean and standard deviation for age and HbA1c levels across the entire dataset, without stratifying by year.\n\nThe mean age is approximately 56 years, with a standard deviation of about 12 years, indicating a middle-aged population with some variability in age. The mean HbA1c level is around $6.2\\%$, with a standard deviation of about $1.5\\%$, suggesting that, on average, the population has HbA1c levels slightly above the normal range (typically $<5.7\\%$ for non-diabetic individuals), with considerable variability.\n\n### Comparisons by Year\n\nTo compare these statistics by year, we can use the `group_by` function to group the data by the `year` variable before summarising.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiabetes_data |>\n  group_by(year) |>\n  summarise(\n    n = n(),\n    age_mean = mean(age, na.rm = TRUE),\n    hba1c_mean = mean(lab_hba1c, na.rm = TRUE)\n    )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n   year     n age_mean hba1c_mean\n  <dbl> <int>    <dbl>      <dbl>\n1  2015   250     56.7       5.87\n2  2025   250     56.0       6.05\n```\n\n\n:::\n:::\n\n\nOr, with the `table()` function we can create a contingency table showing the distribution of diabetes status across the two years.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable_diabetes_year <- table(diabetes_data$year,\n                             diabetes_data$diabetes_total)\n\ntable_diabetes_year\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      \n        no yes\n  2015 212  38\n  2025 188  62\n```\n\n\n:::\n:::\n\n\n\n## Prevalence Calculation\n\nTo calculate the prevalence of diabetes for each year, we can use the `group_by` and `summarise` functions to compute the mean of the binary indicator for diabetes status.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprev_diabetes <- diabetes_data |>\n  group_by(year, diabetes_total) |>\n  summarise(n = n(), .groups = \"drop\") |>\n  group_by(year) |> \n  mutate(prop = n / sum(n))\n\nprev_diabetes\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 4\n# Groups:   year [2]\n   year diabetes_total     n  prop\n  <dbl> <chr>          <int> <dbl>\n1  2015 no               212 0.848\n2  2015 yes               38 0.152\n3  2025 no               188 0.752\n4  2025 yes               62 0.248\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprev_summary <- diabetes_data |>\n  group_by(year) |>\n  summarise(prev_diabetes = mean(diabetes_total == \"yes\", \n                                 na.rm=TRUE))\nprev_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n   year prev_diabetes\n  <dbl>         <dbl>\n1  2015         0.152\n2  2025         0.248\n```\n\n\n:::\n:::\n\n\n### Prevalence Table with Confidence Intervals\n\nTo calculate prevalence with confidence intervals, we can use the `prop.test` function within a custom summarise operation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprev_ci <- diabetes_data |>\n  group_by(year) |>\n  summarise(\n    n = n(),\n    cases = sum(diabetes_total == \"yes\", na.rm = TRUE),\n    prev = cases / n,\n    ci_lower = prop.test(cases, n)$conf.int[1],\n    ci_upper = prop.test(cases, n)$conf.int[2]\n  )\nprev_ci\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 6\n   year     n cases  prev ci_lower ci_upper\n  <dbl> <int> <int> <dbl>    <dbl>    <dbl>\n1  2015   250    38 0.152    0.111    0.204\n2  2025   250    62 0.248    0.197    0.307\n```\n\n\n:::\n:::\n\n\n### Visualize diabetes prevalence by year\n\nTo visualize diabetes prevalence by year, we can create a bar plot using the `ggplot2` package. This plot will show the proportion of individuals with diabetes for each year.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(prev_ci, \n       aes(x = factor(year), \n           y = prev, \n           fill = factor(year))) +\n  geom_col() +\n  geom_errorbar(aes(ymin = ci_lower, \n                    ymax = ci_upper), \n                width = 0.2) +\n  scale_y_continuous(labels = scales::percent) +\n  labs(title = \"Diabetes Prevalence by Year\",\n       x = \"Year\",\n       y = \"Prevalence (%)\",\n       fill = \"Year\")\n```\n\n::: {.cell-output-display}\n![](02-exploring-diabetes-data_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n### Interaction\n\nTo explore the interaction between gender, age, and diabetes status, we can create a faceted bar plot. This plot will show the distribution of diabetes status across different age groups, separated by gender.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diabetes_data, \n       aes(x = age_group, \n           fill = diabetes_total)) +\n  geom_bar(position = \"fill\") +\n  scale_y_continuous(labels = scales::percent) +\n  labs(title = \"Diabetes Status by Age Group and Gender\",\n       x = \"Age Group\",\n       y = \"Proportion\",\n       fill = \"Diabetes Status\") +\n  facet_wrap(~sex)\n```\n\n::: {.cell-output-display}\n![](02-exploring-diabetes-data_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\nInteraction between gender, age and diabetes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diabetes_data, \n       aes(x = diabetes_total, y = age, \n           fill = sex)) +\n  geom_boxplot(alpha = 0.6, \n               outlier.color = \"gray40\") +\n  labs(title = \"Age Distribution by Diabetes Status and Gender\",\n       x = \"Diabetes\",\n       y = \"Age\",\n       fill = \"Gender\") \n```\n\n::: {.cell-output-display}\n![](02-exploring-diabetes-data_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n\n## Qualitative Statistical Inference\n\nTo answer our research questions regarding diabetes prevalence, we will use the **Chi-Square Test of Independence**. This test is appropriate for categorical data and helps us determine whether there is a significant association between two categorical variables.\n\n> Question 1: The prevalence of diabetes changed significantly between 2015 and 2025?\n\n### Chi-square Test for Year and Diabetes Status\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable_year <- table(diabetes_data$year, \n                    diabetes_data$diabetes_total)\n\ntable_year\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      \n        no yes\n  2015 212  38\n  2025 188  62\n```\n\n\n:::\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchi_year <- chisq.test(table_year)\n\nchi_year\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's Chi-squared test with Yates' continuity correction\n\ndata:  table_year\nX-squared = 6.6125, df = 1, p-value = 0.01013\n```\n\n\n:::\n:::\n\n\nThe p-value is below 0.05, so we reject the null hypothesis and conclude that prevalence differs between 2015 and 2025 in this dataset. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nchi_year$expected\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      \n        no yes\n  2015 200  50\n  2025 200  50\n```\n\n\n:::\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Standardized Residuals\nres_year <- chi_year$stdres\nres_year\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      \n              no       yes\n  2015  2.683282 -2.683282\n  2025 -2.683282  2.683282\n```\n\n\n:::\n:::\n\n\n\n> Question 2: Will the prevalence of diabetes differ significantly between countries in the year 2025?\n\n### Chi-square Test for Country and Diabetes Status in 2025\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiabetes_data_2025 <- diabetes_data |> filter(year == 2025)\n```\n:::\n\n\nContingency table for countries and diabetes\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_2025 <- table(diabetes_data_2025$country,\n                  diabetes_data_2025$diabetes_total)\ntab_2025\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        \n         no yes\n  Africa 27   6\n  Brazil 42  25\n  China  39  11\n  Rome   40  10\n  USA    40  10\n```\n\n\n:::\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchi_2025 <- chisq.test(tab_2025)\nchi_2025\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's Chi-squared test\n\ndata:  tab_2025\nX-squared = 7.8461, df = 4, p-value = 0.09738\n```\n\n\n:::\n:::\n\n\nThe p-value is greater than 0.05. Therefore, we fail to reject the null hypothesis and conclude that there is no statistically significant difference in diabetes prevalence between countries in 2025.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchi_2025$expected\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        \n             no    yes\n  Africa 24.816  8.184\n  Brazil 50.384 16.616\n  China  37.600 12.400\n  Rome   37.600 12.400\n  USA    37.600 12.400\n```\n\n\n:::\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Standardized Residuals\nresiduals <- chi_2025$stdres\nround(residuals, 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        \n            no   yes\n  Africa  0.94 -0.94\n  Brazil -2.77  2.77\n  China   0.51 -0.51\n  Rome    0.88 -0.88\n  USA     0.88 -0.88\n```\n\n\n:::\n:::\n\n\nIdentify where the greatest contribution lies\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmosaicplot(tab_2025,\n           main = \"Mosaic Plot — Diabetes by Country (2025)\",\n           color = TRUE, las = 1)\n```\n\n::: {.cell-output-display}\n![](02-exploring-diabetes-data_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n:::{.callout-note appearance=\"simple\" title=\"Interpretation\"}\nInterpretation: We fail to reject the null hypothesis. There is no statistically significant evidence that diabetes prevalence differs between countries in 2025 at the 5% significance level.\n\nAlthough some countries show larger deviations from expected counts, these differences are not strong enough, overall, to conclude that prevalence differs significantly across countries.\n:::\n\n## Bonus\n\n### Frequency Table for BMI Categories\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrosstable(diabetes_data, by = \"year\", \n           cols = c(\"sex\",\"diabetes_total\",\n                    \"bmi_cat\",\"country\",\"sdi\")) %>%\n  as_flextable() \n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-f3c30da6{table-layout:auto;}.cl-f3bd7652{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-f3bd7666{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-f3bf8ea6{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-f3bf8eb0{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-f3bfa68e{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(0, 0, 0, 1.00);border-top: 1.5pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f3bfa698{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1.5pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f3bfa699{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f3bfa6a2{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f3bfa6a3{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f3bfa6a4{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f3bfa6ac{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f3bfa6ad{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-f3bfa6b6{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-f3c30da6'><thead><tr style=\"overflow-wrap:break-word;\"><th  rowspan=\"2\"class=\"cl-f3bfa68e\"><p class=\"cl-f3bf8ea6\"><span class=\"cl-f3bd7652\">label</span></p></th><th  rowspan=\"2\"class=\"cl-f3bfa68e\"><p class=\"cl-f3bf8ea6\"><span class=\"cl-f3bd7652\">variable</span></p></th><th  colspan=\"2\"class=\"cl-f3bfa698\"><p class=\"cl-f3bf8ea6\"><span class=\"cl-f3bd7652\">year</span></p></th></tr><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-f3bfa699\"><p class=\"cl-f3bf8ea6\"><span class=\"cl-f3bd7652\">2015</span></p></th><th class=\"cl-f3bfa699\"><p class=\"cl-f3bf8ea6\"><span class=\"cl-f3bd7652\">2025</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td  rowspan=\"2\"class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">sex</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">men</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">125 (50.00%)</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">125 (50.00%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">woman</span></p></td><td class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">125 (50.00%)</span></p></td><td class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">125 (50.00%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td  rowspan=\"2\"class=\"cl-f3bfa6a4\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">diabetes_total</span></p></td><td class=\"cl-f3bfa6ac\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">no</span></p></td><td class=\"cl-f3bfa6ac\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">212 (53.00%)</span></p></td><td class=\"cl-f3bfa6ac\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">188 (47.00%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">yes</span></p></td><td class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">38 (38.00%)</span></p></td><td class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">62 (62.00%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td  rowspan=\"4\"class=\"cl-f3bfa6a4\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">bmi_cat</span></p></td><td class=\"cl-f3bfa6ac\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">Normal weight</span></p></td><td class=\"cl-f3bfa6ac\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">95 (48.22%)</span></p></td><td class=\"cl-f3bfa6ac\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">102 (51.78%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">Obesity</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">56 (54.90%)</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">46 (45.10%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">Overweight</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">85 (52.15%)</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">78 (47.85%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">Underweight</span></p></td><td class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">14 (36.84%)</span></p></td><td class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">24 (63.16%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td  rowspan=\"5\"class=\"cl-f3bfa6a4\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">country</span></p></td><td class=\"cl-f3bfa6ac\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">Africa</span></p></td><td class=\"cl-f3bfa6ac\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">67 (67.00%)</span></p></td><td class=\"cl-f3bfa6ac\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">33 (33.00%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">Brazil</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">33 (33.00%)</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">67 (67.00%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">China</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">66 (56.90%)</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">50 (43.10%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">Rome</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">34 (40.48%)</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">50 (59.52%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">USA</span></p></td><td class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">50 (50.00%)</span></p></td><td class=\"cl-f3bfa6a2\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">50 (50.00%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td  rowspan=\"3\"class=\"cl-f3bfa6ad\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">sdi</span></p></td><td class=\"cl-f3bfa6ac\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">High</span></p></td><td class=\"cl-f3bfa6ac\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">100 (50.00%)</span></p></td><td class=\"cl-f3bfa6ac\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">100 (50.00%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">Intermediate</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">100 (50.00%)</span></p></td><td class=\"cl-f3bfa6a3\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">100 (50.00%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-f3bfa6b6\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">Low</span></p></td><td class=\"cl-f3bfa6b6\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">50 (50.00%)</span></p></td><td class=\"cl-f3bfa6b6\"><p class=\"cl-f3bf8eb0\"><span class=\"cl-f3bd7666\">50 (50.00%)</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n\n### BMI Categories by Year\n\nThe distribution of BMI categories by year can be examined using counts and proportions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiabetes_data |>\n  count(year, bmi_cat) |>\n  group_by(year) |>\n  mutate(prop = n / sum(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 4\n# Groups:   year [2]\n   year bmi_cat           n  prop\n  <dbl> <chr>         <int> <dbl>\n1  2015 Normal weight    95 0.38 \n2  2015 Obesity          56 0.224\n3  2015 Overweight       85 0.34 \n4  2015 Underweight      14 0.056\n5  2025 Normal weight   102 0.408\n6  2025 Obesity          46 0.184\n7  2025 Overweight       78 0.312\n8  2025 Underweight      24 0.096\n```\n\n\n:::\n:::\n\n\n\n### Visualizing BMI Categories by Year\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = diabetes_data, \n       aes(x = bmi_cat, fill = factor(year))) +\n  geom_bar(position = \"dodge\") +\n  labs(title = \"BMI categories by year\",\n       x = \"BMI category\",\n       y = \"Count\",\n       fill = \"Year\")\n```\n\n::: {.cell-output-display}\n![](02-exploring-diabetes-data_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\n### Proportional Distribution of BMI Categories by Year\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diabetes_data, \n       aes(x = bmi_cat, fill = factor(year))) +\n  geom_bar(position = \"fill\") +\n  scale_y_continuous(labels = scales::percent) +\n  labs(title = \"BMI categories by year (proportions)\",\n       x = \"BMI category\",\n       y = \"Proportion\",\n       fill = \"Year\")\n```\n\n::: {.cell-output-display}\n![](02-exploring-diabetes-data_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n\n",
    "supporting": [
      "02-exploring-diabetes-data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/tabwid-1.1.3/tabwid.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}